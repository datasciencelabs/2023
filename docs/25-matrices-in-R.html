<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.353">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>BST 260 Introduction to Data Science - 25&nbsp; Matrices in R</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./24-corrleation-not-causation.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="nav-sidebar floating">


<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./25-matrices-in-R.html"><span class="chapter-number">25</span>&nbsp; <span class="chapter-title">Matrices in R</span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">BST 260 Introduction to Data Science</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/datasciencelabs/2023" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Course description</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./schedule.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Schedule</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01-quarto.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Quarto</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02-unix.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Unix</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03-git.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Git and GitHub</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04-r-basics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">R Basics</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05-vectorization.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Vectorization</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./06-tidyverse.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Tidyverse</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./07-dates-and-times.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Dates and times</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./08-importing-data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Importing data</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./09-data-table.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">data.table</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./pset1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Problem Set 1</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./10-distributions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Distributions</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./11-ggplot2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">ggplot2</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./12-dataviz-principles.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Data visualization principles</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./13-wrangling.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Wrangling</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./14-web-scraping.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Web scraping</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./15-locales.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Locales</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./16-text-mining.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Text mining</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./17-probability.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Probability</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./18-inference.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Inference</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./19-models.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">Models</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./pset2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Problem Set 2</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./20-regression.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">20</span>&nbsp; <span class="chapter-title">Regression</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./21-multivariate-regression.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">21</span>&nbsp; <span class="chapter-title">Multivariate Regression</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./22-linear-models.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">22</span>&nbsp; <span class="chapter-title">Linear models</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./23-association-tests.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">23</span>&nbsp; <span class="chapter-title">Association tests</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./24-corrleation-not-causation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">24</span>&nbsp; <span class="chapter-title">Association is not causation</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./25-matrices-in-R.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">25</span>&nbsp; <span class="chapter-title">Matrices in R</span></span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#sec-mnist" id="toc-sec-mnist" class="nav-link active" data-scroll-target="#sec-mnist"><span class="header-section-number">25.1</span> Case study: MNIST</a></li>
  <li><a href="#sec-matrix-notation" id="toc-sec-matrix-notation" class="nav-link" data-scroll-target="#sec-matrix-notation"><span class="header-section-number">25.2</span> Mathematical notation</a></li>
  <li><a href="#converting-vectors-to-a-matrices" id="toc-converting-vectors-to-a-matrices" class="nav-link" data-scroll-target="#converting-vectors-to-a-matrices"><span class="header-section-number">25.3</span> Converting vectors to a matrices</a></li>
  <li><a href="#motivating-questions" id="toc-motivating-questions" class="nav-link" data-scroll-target="#motivating-questions"><span class="header-section-number">25.4</span> Motivating questions</a></li>
  <li><a href="#row-and-column-summaries" id="toc-row-and-column-summaries" class="nav-link" data-scroll-target="#row-and-column-summaries"><span class="header-section-number">25.5</span> Row and column summaries</a></li>
  <li><a href="#apply" id="toc-apply" class="nav-link" data-scroll-target="#apply"><span class="header-section-number">25.6</span> <code>apply</code></a></li>
  <li><a href="#filtering-columns-based-on-summaries" id="toc-filtering-columns-based-on-summaries" class="nav-link" data-scroll-target="#filtering-columns-based-on-summaries"><span class="header-section-number">25.7</span> Filtering columns based on summaries</a></li>
  <li><a href="#indexing-with-matrices" id="toc-indexing-with-matrices" class="nav-link" data-scroll-target="#indexing-with-matrices"><span class="header-section-number">25.8</span> Indexing with matrices</a></li>
  <li><a href="#binarizing-the-data" id="toc-binarizing-the-data" class="nav-link" data-scroll-target="#binarizing-the-data"><span class="header-section-number">25.9</span> Binarizing the data</a></li>
  <li><a href="#vectorization-for-matrices" id="toc-vectorization-for-matrices" class="nav-link" data-scroll-target="#vectorization-for-matrices"><span class="header-section-number">25.10</span> Vectorization for matrices</a></li>
  <li><a href="#exercises" id="toc-exercises" class="nav-link" data-scroll-target="#exercises"><span class="header-section-number">25.11</span> Exercises</a></li>
  </ul>
<div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/datasciencelabs/2023/blob/main/25-matrices-in-R.qmd" class="toc-action">View source</a></p><p><a href="https://github.com/datasciencelabs/2023/issues/new" class="toc-action">Report an issue</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">25</span>&nbsp; <span class="chapter-title">Matrices in R</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<ul>
<li><p>With matrices, variables for each observation are stored in a row, resulting in a matrix with as many columns as variables.</p></li>
<li><p>In statistics we refer to values represented in the rows of the matrix as the <em>covariates</em> and in machine learning we refer to them as the <em>features</em>.</p></li>
</ul>
<section id="sec-mnist" class="level2" data-number="25.1">
<h2 data-number="25.1" class="anchored" data-anchor-id="sec-mnist"><span class="header-section-number">25.1</span> Case study: MNIST</h2>
<p>An example comes from handwritten digits. The first step in handling mail received in the post office is sorting letters by zip code:</p>
<p><img src="https://rafalab.dfci.harvard.edu/dsbook-part-2/ml/img/how-to-write-a-address-on-an-envelope-how-to-write-the-address-on-an-envelope-write-address-on-envelope-india-finishedenvelope-x69070.png" class="img-fluid"></p>
<p>These are the digitized images:</p>
<div class="cell" data-hash="25-matrices-in-R_cache/html/digit-images-example_1a56dc9588220b3cc1fe65672e3eabf6">
<div class="cell-output-display">
<p><img src="25-matrices-in-R_files/figure-html/digit-images-example-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<ul>
<li><p>The images are converted into <span class="math inline">\(28 \times 28 = 784\)</span> pixels</p></li>
<li><p>For each pixel, we obtain a grey scale intensity between 0 (white) and 255 (black).</p></li>
</ul>
<div class="cell" data-hash="25-matrices-in-R_cache/html/example-images_91a4cedf66d064061a241202405101c8">
<div class="cell-output-display">
<p><img src="25-matrices-in-R_files/figure-html/example-images-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>For each digitized image, indexed by <span class="math inline">\(i\)</span>, we are provided 784 variables and a categorical outcome, or <em>label</em>, representing which digit among <span class="math inline">\(0, 1, 2, 3, 4, 5, 6, 7 , 8,\)</span> and <span class="math inline">\(9\)</span> the image is representing. Let’s load the data using the <strong>dslabs</strong> package:</p>
<div class="cell" data-hash="25-matrices-in-R_cache/html/unnamed-chunk-1_862893d01730e1880213c550f779a2bf">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dslabs)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">exists</span>(<span class="st">"mnist"</span>)) mnist <span class="ot">&lt;-</span> <span class="fu">read_mnist</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>In these cases, the pixel intensities are saved in a matrix:</p>
<div class="cell" data-hash="25-matrices-in-R_cache/html/unnamed-chunk-2_d69c4637eea29379d5690dd404bfb92b">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(mnist<span class="sc">$</span>train<span class="sc">$</span>images)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "matrix" "array" </code></pre>
</div>
</div>
<ul>
<li><p>This matrix represents 60,000 observations, each a digit.</p></li>
<li><p>For example, let’s take a smaller subset:</p></li>
</ul>
<div class="cell" data-hash="25-matrices-in-R_cache/html/unnamed-chunk-3_6194e945fdcc6fd36819163c117a8513">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> mnist<span class="sc">$</span>train<span class="sc">$</span>images[<span class="dv">1</span><span class="sc">:</span><span class="dv">300</span>,] </span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> mnist<span class="sc">$</span>train<span class="sc">$</span>labels[<span class="dv">1</span><span class="sc">:</span><span class="dv">300</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="sec-matrix-notation" class="level2" data-number="25.2">
<h2 data-number="25.2" class="anchored" data-anchor-id="sec-matrix-notation"><span class="header-section-number">25.2</span> Mathematical notation</h2>
<ul>
<li>When working with linear algebra in R we have three types of objects:</li>
</ul>
<ol type="1">
<li>scalars,</li>
<li>vectors, and</li>
<li>matrices.</li>
</ol>
<ul>
<li><p>A scalar is just one number, for example <span class="math inline">\(a = 1\)</span>.</p></li>
<li><p>Vectors are like the numeric vectors we define in R:</p></li>
</ul>
<div class="cell" data-hash="25-matrices-in-R_cache/html/unnamed-chunk-4_dc9da7b4d17f1597faf4d214f7e1e639">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(x[<span class="dv">20</span>,])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 784</code></pre>
</div>
</div>
<ul>
<li>Each feature is represented by a columns of <code>x</code>. For example, the first column contains the values for the first pixel of all 1,000 images:</li>
</ul>
<div class="cell" data-hash="25-matrices-in-R_cache/html/unnamed-chunk-5_a3b68b5aaf40049ab636a8b4a47388b1">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(x[,<span class="dv">1</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 300</code></pre>
</div>
</div>
<p>In matrix algebra, we use lower case bold letters to represent a vector of features/predictors/covariates:</p>
<p><span class="math display">\[
\mathbf{x} =
\begin{pmatrix}
x_1\\\
x_2\\\
\vdots\\\
x_n
\end{pmatrix}
\]</span></p>
<p>Similarly, we can use math notation to represent different features by adding an index:</p>
<p><span class="math display">\[
\mathbf{x}_1 = \begin{pmatrix}
x_{1,1}\\
\vdots\\
x_{n,1}
\end{pmatrix} \mbox{ and }
\mathbf{x}_2 = \begin{pmatrix}
x_{1,2}\\
\vdots\\
x_{n,2}
\end{pmatrix}
\]</span></p>
<ul>
<li>A matrix can be defined as a series of vectors of the same size joined together as columns:</li>
</ul>
<div class="cell" data-hash="25-matrices-in-R_cache/html/unnamed-chunk-6_ff44192cd57179da568852f932a4f549">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>x_1 <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>x_2 <span class="ot">&lt;-</span> <span class="dv">6</span><span class="sc">:</span><span class="dv">10</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="fu">cbind</span>(x_1, x_2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     x_1 x_2
[1,]   1   6
[2,]   2   7
[3,]   3   8
[4,]   4   9
[5,]   5  10</code></pre>
</div>
</div>
<ul>
<li>Mathematically, we represent them with bold upper case letters:</li>
</ul>
<p><span class="math display">\[
\mathbf{X} = ( \mathbf{x}_1 \, \mathbf{x}_2 ) = \begin{pmatrix}
x_{1,1}&amp;x_{1,2}\\
\vdots&amp;\vdots\\
x_{n,1}&amp;x_{n,2}
\end{pmatrix}
\]</span></p>
<ul>
<li>We can use this notation to denote an arbitrary number of predictors with the following <span class="math inline">\(n\times p\)</span> matrix, for example, with <span class="math inline">\(n = 300\)</span>, and <span class="math inline">\(p=784\)</span>:</li>
</ul>
<p><span class="math display">\[
\mathbf{X} =
\begin{pmatrix}
  x_{1,1}&amp;x_{1,2}&amp;\dots &amp; x_{1,p} \\
  x_{2,1}&amp;x_{2,2}&amp;\dots &amp; x_{2,p} \\
  \vdots &amp; \vdots &amp; \ddots &amp; \vdots &amp; \\
  x_{n,1}&amp;x_{n,2}&amp;\dots &amp; x_{n,p}
  \end{pmatrix}
\]</span></p>
<ul>
<li>The <em>dimension</em> of a matrix is often an important characteristic needed to assure that certain operations can be performed.</li>
</ul>
<div class="cell" data-hash="25-matrices-in-R_cache/html/unnamed-chunk-7_43885c51f349ed1c526748e83c447665">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(x)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 300 784</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Notation for rows versus columns
</div>
</div>
<div class="callout-body-container callout-body">
<p>Bold lower case letter are also commonly used to represent rows, rather than columns, of a matrix. This can be confusing because <span class="math inline">\(\mathbf{x}_1\)</span> can represent either the first row or the first column. One way to distinguish then is using notation similar to computer code by using the colon <span class="math inline">\(:\)</span> to represent <em>all</em>. So <span class="math inline">\(\mathbf{X}_{1,:}\)</span> is a row, the first row and all the columns, and <span class="math inline">\(\mathbf{X}_{:,1}\)</span> is a column, the first column and all the rows. Another approach is to distinguish by the index, with <span class="math inline">\(i\)</span> used for rows and <span class="math inline">\(j\)</span> used for columns. So <span class="math inline">\(\mathbf{x}_i\)</span> is the <span class="math inline">\(i\)</span>th row and <span class="math inline">\(\mathbf{x}_j\)</span> is the <span class="math inline">\(j\)</span>th column. With this approach it is important to clarify which dimension, row or column, is being represented. We use this last one in the next chapter.</p>
</div>
</div>
</section>
<section id="converting-vectors-to-a-matrices" class="level2" data-number="25.3">
<h2 data-number="25.3" class="anchored" data-anchor-id="converting-vectors-to-a-matrices"><span class="header-section-number">25.3</span> Converting vectors to a matrices</h2>
<ul>
<li>Vectors can be thought of as <span class="math inline">\(n\times 1\)</span> matrices. However, in R, a vector does not have dimensions:</li>
</ul>
<div class="cell" data-hash="25-matrices-in-R_cache/html/unnamed-chunk-8_4b1aff0b4eb555841ca25a9c97e005c6">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(x_1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>NULL</code></pre>
</div>
</div>
<ul>
<li>Vectors are not matrices in R. However, we can easily convert then to a matrix:</li>
</ul>
<div class="cell" data-hash="25-matrices-in-R_cache/html/unnamed-chunk-9_58f0ea325842c18da5c1fb8ea66ec404">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(<span class="fu">matrix</span>(x_1))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 5 1</code></pre>
</div>
</div>
<ul>
<li><p>It is also possible to change the dimensions of the resulting matrix.</p></li>
<li><p>To see an example of how can this be useful, consider wanting to visualize the the rows pixel intensities in their original <span class="math inline">\(28\times28\)</span> grid.</p></li>
</ul>
<div class="cell" data-hash="25-matrices-in-R_cache/html/unnamed-chunk-10_d64b2b18a3e12957919dd5872f5c9171">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>my_vector <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">15</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>mat <span class="ot">&lt;-</span> <span class="fu">matrix</span>(my_vector, <span class="dv">5</span>, <span class="dv">3</span>)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>mat</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     [,1] [,2] [,3]
[1,]    1    6   11
[2,]    2    7   12
[3,]    3    8   13
[4,]    4    9   14
[5,]    5   10   15</code></pre>
</div>
</div>
<ul>
<li>We can fill by row by using the <code>byrow</code> argument:</li>
</ul>
<div class="cell" data-hash="25-matrices-in-R_cache/html/unnamed-chunk-11_b90d96092732a243dacfb887e4e98f7a">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>mat_t <span class="ot">&lt;-</span> <span class="fu">matrix</span>(my_vector, <span class="dv">3</span>, <span class="dv">5</span>, <span class="at">byrow =</span> <span class="cn">TRUE</span>)</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>mat_t</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     [,1] [,2] [,3] [,4] [,5]
[1,]    1    2    3    4    5
[2,]    6    7    8    9   10
[3,]   11   12   13   14   15</code></pre>
</div>
</div>
</section>
<section id="motivating-questions" class="level2" data-number="25.4">
<h2 data-number="25.4" class="anchored" data-anchor-id="motivating-questions"><span class="header-section-number">25.4</span> Motivating questions</h2>
<p>To motivate the use of matrices in R, we will pose five questions/challenges related to the handwritten digits data:</p>
<p>1. Do some digits require more ink to write than others? We will study the distribution of the total pixel darkness and how it varies by digits.</p>
<p>2. Are some pixels uninformative? We will study the variation of each pixel across digits and remove predictors (columns) associated with pixels that don’t change much and thus can’t provide much information for classification.</p>
<p>3. Can we remove smudges? We will first, look at the distribution of all pixel values. Then we will use this to pick a cutoff to define unwritten space. Then, set anything below that cutoff to 0.</p>
<p>4. Binarize the data. First, we will look at the distribution of all pixel values. We will then use this to pick a cutoff to distinguish between writing and no writing. Then, we will convert all entries into either 1 or 0.</p>
<p>5. Standardize the digits. We will scale each of the predictors in each entry to have the same average and standard deviation.</p>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Warning
</div>
</div>
<div class="callout-body-container callout-body">
<p>The <code>matrix</code> function recycles values in the vector <strong>without warning</strong> if the product of columns and rows does not match the length of the vector:</p>
<div class="cell" data-hash="25-matrices-in-R_cache/html/unnamed-chunk-12_b312e6106f6a142a9f13b637516efe1f">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">matrix</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, <span class="dv">2</span>, <span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in matrix(1:3, 2, 5): data length [3] is not a sub-multiple or multiple
of the number of rows [2]</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>     [,1] [,2] [,3] [,4] [,5]
[1,]    1    3    2    1    3
[2,]    2    1    3    2    1</code></pre>
</div>
</div>
</div>
</div>
<ul>
<li>To put the pixel intensities of our, say, 3rd entry, which is a 4 into grid, we can use:</li>
</ul>
<div class="cell" data-hash="25-matrices-in-R_cache/html/unnamed-chunk-13_df47cae08919fa33b9349147cd796d61">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>grid <span class="ot">&lt;-</span> <span class="fu">matrix</span>(x[<span class="dv">3</span>,], <span class="dv">28</span>, <span class="dv">28</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>Confirm with plots</li>
</ul>
<div class="cell" data-hash="25-matrices-in-R_cache/html/unnamed-chunk-14_c302d8df44af6e8e365e5b3d09cacfc9">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">image</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">28</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">28</span>, grid)</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="fu">image</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">28</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">28</span>, grid[, <span class="dv">28</span><span class="sc">:</span><span class="dv">1</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="row-and-column-summaries" class="level2" data-number="25.5">
<h2 data-number="25.5" class="anchored" data-anchor-id="row-and-column-summaries"><span class="header-section-number">25.5</span> Row and column summaries</h2>
<ul>
<li>The function <code>rowSums</code> takes a matrix as input and computes the desired values:</li>
</ul>
<div class="cell" data-hash="25-matrices-in-R_cache/html/unnamed-chunk-15_fbc0bd9e4ddad3b81836f4bab81ecc5d">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>sums <span class="ot">&lt;-</span> <span class="fu">rowSums</span>(x)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>We can also compute the averages with <code>rowMeans</code></li>
</ul>
<div class="cell" data-hash="25-matrices-in-R_cache/html/unnamed-chunk-16_470d04aac2c330d371a8a519c1db796e">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>avg <span class="ot">&lt;-</span> <span class="fu">rowMeans</span>(x)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>For the first task, look at boxplots:</li>
</ul>
<div class="cell" data-hash="25-matrices-in-R_cache/html/boxplot-of-digit-averages_ed3c7bc36c39dc5788d4edc5a40bd9fc">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">boxplot</span>(avg <span class="sc">~</span> y)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="25-matrices-in-R_files/figure-html/boxplot-of-digit-averages-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<ul>
<li><p>Is this expected?</p></li>
<li><p>We can compute the column sums and averages using the function <code>colSums</code> and <code>colMeans</code>, respectively.</p></li>
</ul>
<p>The <strong>matrixStats</strong> package adds functions that performs operations on each row or column very efficiently, including the functions <code>rowSds</code> and <code>colSds</code>.</p>
</section>
<section id="apply" class="level2" data-number="25.6">
<h2 data-number="25.6" class="anchored" data-anchor-id="apply"><span class="header-section-number">25.6</span> <code>apply</code></h2>
<ul>
<li><p>The <code>apply</code> function lets you apply any function, not just <code>sum</code> or <code>mean</code>, to the rows or columns of a matrix.</p></li>
<li><p>The first argument is the matrix, the second is the dimension, 1 for rows, 2 for columns, and the third is the function.</p></li>
<li><p>So, for example, <code>rowMeans</code> can be written as:</p></li>
</ul>
<div class="cell" data-hash="25-matrices-in-R_cache/html/unnamed-chunk-17_49ba73c5d372ec88beef6353f3b4d297">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>avgs <span class="ot">&lt;-</span> <span class="fu">apply</span>(x, <span class="dv">1</span>, mean)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>for the sds:</li>
</ul>
<div class="cell" data-hash="25-matrices-in-R_cache/html/unnamed-chunk-18_b522e0e5ebca236594e4b2678aed3205">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>sds <span class="ot">&lt;-</span> <span class="fu">apply</span>(x, <span class="dv">2</span>, sd)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>The trade off for this flexibility is that these operations are not as fast as dedicated functions such as <code>rowMeans</code>.</li>
</ul>
</section>
<section id="filtering-columns-based-on-summaries" class="level2" data-number="25.7">
<h2 data-number="25.7" class="anchored" data-anchor-id="filtering-columns-based-on-summaries"><span class="header-section-number">25.7</span> Filtering columns based on summaries</h2>
<ul>
<li>We now turn to task 2: studying the variation of each pixel and removing columns associated with pixels that don’t change much and thus do not inform the classification.</li>
</ul>
<div class="cell" data-hash="25-matrices-in-R_cache/html/unnamed-chunk-19_7f05622955e10b291ec60bd0327d292e">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(matrixStats)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'matrixStats'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:dplyr':

    count</code></pre>
</div>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>sds <span class="ot">&lt;-</span> <span class="fu">colSds</span>(x)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>A quick look at the distribution of these values shows that some pixels have very low entry to entry variability:</li>
</ul>
<div class="cell" data-hash="25-matrices-in-R_cache/html/unnamed-chunk-20_05db03391242b41e738fa10c278e0bf2">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(sds, <span class="at">breaks =</span> <span class="dv">30</span>, <span class="at">main =</span> <span class="st">"SDs"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="25-matrices-in-R_files/figure-html/unnamed-chunk-20-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<ul>
<li>To see where the low variance pixels are:</li>
</ul>
<div class="cell" data-hash="25-matrices-in-R_cache/html/unnamed-chunk-21_5c4f529cd3e741cca90de5cdb791bec2">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="fu">image</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">28</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">28</span>, <span class="fu">matrix</span>(sds, <span class="dv">28</span>, <span class="dv">28</span>)[, <span class="dv">28</span><span class="sc">:</span><span class="dv">1</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="25-matrices-in-R_files/figure-html/unnamed-chunk-21-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<ul>
<li><p>We see that there is little variation in the corners.</p></li>
<li><p>We could remove features that have no variation since these can’t help us predict. We can extract columns from matrices using the following code:</p></li>
</ul>
<div class="cell" data-hash="25-matrices-in-R_cache/html/unnamed-chunk-22_4e99490e3f91a1b4437b4244b0b3168d">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>x[ ,<span class="fu">c</span>(<span class="dv">351</span>,<span class="dv">352</span>)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>and rows like this:</p>
<div class="cell" data-hash="25-matrices-in-R_cache/html/unnamed-chunk-23_6cef57d1ba8b4eeb7eed9b8247cb0e33">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>x[<span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">3</span>),]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>We can also use logical indexes to determine which columns or rows to keep.</li>
</ul>
<div class="cell" data-hash="25-matrices-in-R_cache/html/unnamed-chunk-24_3645eff077243430f1e56d13e02634c6">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>new_x <span class="ot">&lt;-</span> x[ ,<span class="fu">colSds</span>(x) <span class="sc">&gt;</span> <span class="dv">60</span>]</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(new_x)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 300 316</code></pre>
</div>
</div>
<ul>
<li><p>Only the columns for which the standard deviation is above 60 are kept, which removes over half the predictors.</p></li>
<li><p>Here we add an important warning related to subsetting matrices: if you select one column or one row, the result is no longer a matrix but a vector.</p></li>
</ul>
<div class="cell" data-hash="25-matrices-in-R_cache/html/unnamed-chunk-25_802b1150fd5120183f3e42e5a782b7e1">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(x[, <span class="dv">1</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "integer"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(x[<span class="dv">1</span>, ])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>NULL</code></pre>
</div>
</div>
<ul>
<li>However, we can preserve the matrix class by using the argument <code>drop=FALSE</code>:</li>
</ul>
<div class="cell" data-hash="25-matrices-in-R_cache/html/unnamed-chunk-26_b27773329bbb537434997074ba35b61e">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(x[, <span class="dv">1</span>, <span class="at">drop =</span> <span class="cn">FALSE</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "matrix" "array" </code></pre>
</div>
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(x[, <span class="dv">1</span>, <span class="at">drop =</span> <span class="cn">FALSE</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 300   1</code></pre>
</div>
</div>
</section>
<section id="indexing-with-matrices" class="level2" data-number="25.8">
<h2 data-number="25.8" class="anchored" data-anchor-id="indexing-with-matrices"><span class="header-section-number">25.8</span> Indexing with matrices</h2>
<ul>
<li>We can turn matrices into vectors.</li>
</ul>
<div class="cell" data-hash="25-matrices-in-R_cache/html/unnamed-chunk-27_4ce1bdc5ec22d7bea2973e5902150a3a">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>mat <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">15</span>, <span class="dv">5</span>, <span class="dv">3</span>)</span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a><span class="fu">as.vector</span>(mat)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1]  1  2  3  4  5  6  7  8  9 10 11 12 13 14 15</code></pre>
</div>
</div>
<p>To see a histogram of all our predictor data, we can use:</p>
<div class="cell" data-hash="25-matrices-in-R_cache/html/unnamed-chunk-28_dd0180a1bb93db035d71d2464414ab5a">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(<span class="fu">as.vector</span>(x), <span class="at">breaks =</span> <span class="dv">30</span>, <span class="at">main =</span> <span class="st">"Pixel intensities"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="25-matrices-in-R_files/figure-html/unnamed-chunk-28-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<ul>
<li>We notice a clear dichotomy which is explained as parts of the image with ink and parts without. If we think that values below, say, 50 are smudges, we can quickly make them zero using:</li>
</ul>
<div class="cell" data-hash="25-matrices-in-R_cache/html/unnamed-chunk-29_1d5aadc955273f903cc0ddc21d6d262f">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>new_x <span class="ot">&lt;-</span> x</span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>new_x[new_x <span class="sc">&lt;</span> <span class="dv">50</span>] <span class="ot">&lt;-</span> <span class="dv">0</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>To see what this does, we look at a smaller matrix:</li>
</ul>
<div class="cell" data-hash="25-matrices-in-R_cache/html/unnamed-chunk-30_99a41bf456d3438f48ddbc88da189d3e">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>mat <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">15</span>, <span class="dv">5</span>, <span class="dv">3</span>)</span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>mat[mat <span class="sc">&lt;</span> <span class="dv">3</span>] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>mat</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     [,1] [,2] [,3]
[1,]    0    6   11
[2,]    0    7   12
[3,]    3    8   13
[4,]    4    9   14
[5,]    5   10   15</code></pre>
</div>
</div>
<ul>
<li>We can also use logical operations with matrix logical:</li>
</ul>
<div class="cell" data-hash="25-matrices-in-R_cache/html/unnamed-chunk-31_305ba62648058fe55743582218917199">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>mat <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">15</span>, <span class="dv">5</span>, <span class="dv">3</span>)</span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>mat[mat <span class="sc">&gt;</span> <span class="dv">6</span> <span class="sc">&amp;</span> mat <span class="sc">&lt;</span> <span class="dv">12</span>] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>mat</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     [,1] [,2] [,3]
[1,]    1    6    0
[2,]    2    0   12
[3,]    3    0   13
[4,]    4    0   14
[5,]    5    0   15</code></pre>
</div>
</div>
</section>
<section id="binarizing-the-data" class="level2" data-number="25.9">
<h2 data-number="25.9" class="anchored" data-anchor-id="binarizing-the-data"><span class="header-section-number">25.9</span> Binarizing the data</h2>
<p>The histogram above seems to suggest that this data is mostly binary. A pixel either has ink or does not. Using what we have learned, we can binarize the data using just matrix operations:</p>
<div class="cell" data-hash="25-matrices-in-R_cache/html/unnamed-chunk-32_b1ea830614e4daa28f9afea34c809404">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>bin_x <span class="ot">&lt;-</span> x</span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>bin_x[bin_x <span class="sc">&lt;</span> <span class="dv">255</span><span class="sc">/</span><span class="dv">2</span>] <span class="ot">&lt;-</span> <span class="dv">0</span> </span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>bin_x[bin_x <span class="sc">&gt;</span> <span class="dv">255</span><span class="sc">/</span><span class="dv">2</span>] <span class="ot">&lt;-</span> <span class="dv">1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>We can also convert to a matrix of logicals and then coerce to numbers like this:</li>
</ul>
<div class="cell" data-hash="25-matrices-in-R_cache/html/unnamed-chunk-33_afb23f97f8fa61e333ec101d2df77623">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>bin_X <span class="ot">&lt;-</span> (x <span class="sc">&gt;</span> <span class="dv">255</span><span class="sc">/</span><span class="dv">2</span>)<span class="sc">*</span><span class="dv">1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="vectorization-for-matrices" class="level2" data-number="25.10">
<h2 data-number="25.10" class="anchored" data-anchor-id="vectorization-for-matrices"><span class="header-section-number">25.10</span> Vectorization for matrices</h2>
<p>In R, if we subtract a vector from a matrix, the first element of the vector is subtracted from the first row, the second element from the second row, and so on. Using mathematical notation, we would write it as follows:</p>
<p><span class="math display">\[
\begin{pmatrix}
  X_{1,1}&amp;\dots &amp; X_{1,p} \\
  X_{2,1}&amp;\dots &amp; X_{2,p} \\
   &amp; \vdots &amp; \\
  X_{n,1}&amp;\dots &amp; X_{n,p}
  \end{pmatrix}
-
\begin{pmatrix}
a_1\\\
a_2\\\
\vdots\\\
a_n
\end{pmatrix}
=
\begin{pmatrix}
  X_{1,1}-a_1&amp;\dots &amp; X_{1,p} -a_1\\
  X_{2,1}-a_2&amp;\dots &amp; X_{2,p} -a_2\\
   &amp; \vdots &amp; \\
  X_{n,1}-a_n&amp;\dots &amp; X_{n,p} -a_n
  \end{pmatrix}
\]</span></p>
<ul>
<li>The same holds true for other arithmetic operations. This implies that we can scale each row of a matrix like this:</li>
</ul>
<div class="cell" data-hash="25-matrices-in-R_cache/html/unnamed-chunk-34_f659a19c2c92665991e77d062ded306b">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>(x <span class="sc">-</span> <span class="fu">rowMeans</span>(x)) <span class="sc">/</span> <span class="fu">rowSds</span>(x)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>If you want to scale each column, be careful since this approach does not work for columns. To perform a similar operation, we convert the columns to rows using the transpose <code>t</code>, proceed as above, and then transpose back:</li>
</ul>
<div class="cell" data-hash="25-matrices-in-R_cache/html/unnamed-chunk-35_4711aa26fec0958f99a6da81d6b24ca7">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="fu">t</span>(<span class="fu">t</span>(X) <span class="sc">-</span> <span class="fu">colMeans</span>(X))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>We can also use a function called <code>sweep</code> that works similarly to <code>apply</code>. It takes each entry of a vector and subtracts it from the corresponding row or column.</li>
</ul>
<div class="cell" data-hash="25-matrices-in-R_cache/html/unnamed-chunk-36_2f22bac9d8f30581f53c48de307c7629">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>X_mean_0 <span class="ot">&lt;-</span> <span class="fu">sweep</span>(x, <span class="dv">2</span>, <span class="fu">colMeans</span>(x))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>The function <code>sweep</code> actually has another argument that lets you define the arithmetic operation. So to divide by the standard deviation, we do the following:</li>
</ul>
<div class="cell" data-hash="25-matrices-in-R_cache/html/unnamed-chunk-37_139a37678926f65ef1a21dee8f525ff7">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>x_mean_0 <span class="ot">&lt;-</span> <span class="fu">sweep</span>(x, <span class="dv">2</span>, <span class="fu">colMeans</span>(x))</span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>x_standardized <span class="ot">&lt;-</span> <span class="fu">sweep</span>(x_mean_0, <span class="dv">2</span>, <span class="fu">colSds</span>(x), <span class="at">FUN =</span> <span class="st">"/"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>In R, if you add, subtract, nultiple or divide two matrices, the operation is done elementwise. For example, if two matrices are stored in <code>x</code> and <code>y</code>, then</li>
</ul>
<div class="cell" data-hash="25-matrices-in-R_cache/html/unnamed-chunk-38_8f06d5e6d920e4bcd1e3829f9fd0b0b8">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>x<span class="sc">*</span>y</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>does not result in matrix multiplication. Instead, the entry in row <span class="math inline">\(i\)</span> and column <span class="math inline">\(j\)</span> of this product is the product of the entryin row <span class="math inline">\(i\)</span> and column <span class="math inline">\(j\)</span> of <code>x</code> and <code>y</code>, respectively.</p>
</section>
<section id="exercises" class="level2" data-number="25.11">
<h2 data-number="25.11" class="anchored" data-anchor-id="exercises"><span class="header-section-number">25.11</span> Exercises</h2>
<p>1. Create a 100 by 10 matrix of randomly generated normal numbers. Put the result in <code>x</code>.</p>
<p>2. Apply the three R functions that give you the dimension of <code>x</code>, the number of rows of <code>x</code>, and the number of columns of <code>x</code>, respectively.</p>
<p>3. Add the scalar 1 to row 1, the scalar 2 to row 2, and so on, to the matrix <code>x</code>.</p>
<p>4. Add the scalar 1 to column 1, the scalar 2 to column 2, and so on, to the matrix <code>x</code>. Hint: use <code>sweep</code> with <code>FUN = "+"</code>.</p>
<p>5. Compute the average of each row of <code>x</code>.</p>
<p>6. Compute the average of each column of <code>x</code>.</p>
<p>7. For each digit in the MNIST training data, compute the proportion of pixels that are in a <em>grey area</em>, defined as values between 50 and 205. Make boxplot by digit class. Hint: use logical operators and <code>rowMeans</code>.</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./24-corrleation-not-causation.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">24</span>&nbsp; <span class="chapter-title">Association is not causation</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
  </div>
</nav>
</div> <!-- /content -->



</body></html>