<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.353">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>BST 260 Introduction to Data Science - 13&nbsp; Wrangling</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./14-web-scraping.html" rel="next">
<link href="./12-dataviz-principles.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>


</head>

<body class="nav-sidebar floating">


<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./13-wrangling.html"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Wrangling</span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">BST 260 Introduction to Data Science</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/datasciencelabs/2023" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Course description</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./schedule.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Schedule</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01-quarto.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Quarto</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02-unix.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Unix</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03-git.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Git and GitHub</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04-r-basics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">R Basics</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05-vectorization.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Vectorization</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./06-tidyverse.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Tidyverse</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./07-dates-and-times.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Dates and times</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./08-importing-data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Importing data</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./09-data-table.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">data.table</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./pset1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Problem Set 1</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./10-distributions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Distributions</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./11-ggplot2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">ggplot2</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./12-dataviz-principles.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Data visualization principles</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./13-wrangling.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Wrangling</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./14-web-scraping.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Web scraping</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./15-locales.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Locales</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./16-text-mining.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Text mining</span></span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#reshaping-data" id="toc-reshaping-data" class="nav-link active" data-scroll-target="#reshaping-data"><span class="header-section-number">13.1</span> Reshaping data</a>
  <ul class="collapse">
  <li><a href="#pivot_longer" id="toc-pivot_longer" class="nav-link" data-scroll-target="#pivot_longer"><span class="header-section-number">13.1.1</span> <code>pivot_longer</code></a></li>
  <li><a href="#pivot_wider" id="toc-pivot_wider" class="nav-link" data-scroll-target="#pivot_wider"><span class="header-section-number">13.1.2</span> <code>pivot_wider</code></a></li>
  <li><a href="#sec-separate" id="toc-sec-separate" class="nav-link" data-scroll-target="#sec-separate"><span class="header-section-number">13.1.3</span> <code>separate</code></a></li>
  <li><a href="#unite" id="toc-unite" class="nav-link" data-scroll-target="#unite"><span class="header-section-number">13.1.4</span> <code>unite</code></a></li>
  </ul></li>
  <li><a href="#joining-tables" id="toc-joining-tables" class="nav-link" data-scroll-target="#joining-tables"><span class="header-section-number">13.2</span> Joining tables</a>
  <ul class="collapse">
  <li><a href="#sec-joins" id="toc-sec-joins" class="nav-link" data-scroll-target="#sec-joins"><span class="header-section-number">13.2.1</span> Joins</a></li>
  <li><a href="#set-operators" id="toc-set-operators" class="nav-link" data-scroll-target="#set-operators"><span class="header-section-number">13.2.2</span> Set operators</a></li>
  </ul></li>
  <li><a href="#string-processing" id="toc-string-processing" class="nav-link" data-scroll-target="#string-processing"><span class="header-section-number">13.3</span> String processing</a>
  <ul class="collapse">
  <li><a href="#sec-stringr" id="toc-sec-stringr" class="nav-link" data-scroll-target="#sec-stringr"><span class="header-section-number">13.3.1</span> The stringr package</a></li>
  <li><a href="#case-study-self-reported-heights" id="toc-case-study-self-reported-heights" class="nav-link" data-scroll-target="#case-study-self-reported-heights"><span class="header-section-number">13.3.2</span> Case study: self-reported heights</a></li>
  <li><a href="#regular-expressions" id="toc-regular-expressions" class="nav-link" data-scroll-target="#regular-expressions"><span class="header-section-number">13.3.3</span> Regular expressions</a></li>
  <li><a href="#search-and-replace-with-regex" id="toc-search-and-replace-with-regex" class="nav-link" data-scroll-target="#search-and-replace-with-regex"><span class="header-section-number">13.3.4</span> Search and replace with regex</a></li>
  <li><a href="#trimming" id="toc-trimming" class="nav-link" data-scroll-target="#trimming"><span class="header-section-number">13.3.5</span> Trimming</a></li>
  <li><a href="#changing-lettercase" id="toc-changing-lettercase" class="nav-link" data-scroll-target="#changing-lettercase"><span class="header-section-number">13.3.6</span> Changing lettercase</a></li>
  <li><a href="#the-extract-function" id="toc-the-extract-function" class="nav-link" data-scroll-target="#the-extract-function"><span class="header-section-number">13.3.7</span> The <code>extract</code> function</a></li>
  <li><a href="#putting-it-all-together" id="toc-putting-it-all-together" class="nav-link" data-scroll-target="#putting-it-all-together"><span class="header-section-number">13.3.8</span> Putting it all together</a></li>
  <li><a href="#string-splitting" id="toc-string-splitting" class="nav-link" data-scroll-target="#string-splitting"><span class="header-section-number">13.3.9</span> String splitting</a></li>
  <li><a href="#sec-recode" id="toc-sec-recode" class="nav-link" data-scroll-target="#sec-recode"><span class="header-section-number">13.3.10</span> Recoding</a></li>
  </ul></li>
  <li><a href="#exercises" id="toc-exercises" class="nav-link" data-scroll-target="#exercises"><span class="header-section-number">13.4</span> Exercises</a></li>
  </ul>
<div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/datasciencelabs/2023/blob/main/13-wrangling.qmd" class="toc-action">View source</a></p><p><a href="https://github.com/datasciencelabs/2023/issues/new" class="toc-action">Report an issue</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Wrangling</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<p>On September 20, 2017 Hurricane María made landfall in Puerto Rico. Anecdotal reports pointed to a dire situation. Many did not have power, few have running water, and some have no way to communicate. On October 3 of that year the president of the USA visited Puerto Rico. In a press conference the governor states that the death count is 16. A CNN article reporting on this stated</p>
<blockquote class="blockquote">
<blockquote class="blockquote">
<blockquote class="blockquote">
<p>“Every death is a horror,” Trump said, “but if you look at a real catastrophe like Katrina and you look at the tremendous – hundreds and hundreds of people that died – and you look at what happened here with, really, a storm that was just totally overpowering … no one has ever seen anything like this.” “What is your death count?” he asked as he turned to Puerto Rico Gov.&nbsp;Ricardo Rosselló. “17?” “16,” Rosselló answered. “16 people certified,” Trump said. “Sixteen people versus in the thousands. You can be very proud of all of your people and all of our people working together.</p>
</blockquote>
</blockquote>
</blockquote>
<p>Mortality data was not made publicly available until June 6. At this time the following dataset was made available:</p>
<div class="cell" data-hash="13-wrangling_cache/html/unnamed-chunk-1_eda1d83008221c0d7b32ab1cd180a9c1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>fn <span class="ot">&lt;-</span> <span class="fu">system.file</span>(<span class="st">"extdata"</span>, <span class="st">"RD-Mortality-Report_2015-18-180531.pdf"</span>, <span class="at">package =</span> <span class="st">"dslabs"</span>)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">system2</span>(<span class="st">"open"</span>, fn)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Part of the process of analyzing the data is to extract it from this PDF. To conduct a complete analysis we will also need to add population data.</p>
<p>We can start by reading the pdf into R:</p>
<div class="cell" data-hash="13-wrangling_cache/html/unnamed-chunk-2_ef829f0f89b3c47b36fd27d7fb9815a2">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(pdftools)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Using poppler version 22.02.0</code></pre>
</div>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>fn <span class="ot">&lt;-</span> <span class="fu">system.file</span>(<span class="st">"extdata"</span>, <span class="st">"RD-Mortality-Report_2015-18-180531.pdf"</span>, <span class="at">package =</span> <span class="st">"dslabs"</span>)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> <span class="fu">pdf_text</span>(fn)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> <span class="fu">strsplit</span>(dat, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We will go over data wrangling tasks that we will need to facilitate this data analysis: reshaping data, joining tables, and string processing.</p>
<section id="reshaping-data" class="level2" data-number="13.1">
<h2 data-number="13.1" class="anchored" data-anchor-id="reshaping-data"><span class="header-section-number">13.1</span> Reshaping data</h2>
<div class="cell" data-hash="13-wrangling_cache/html/unnamed-chunk-3_0cc02e083f7aca0c85e95774dd613eba">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse) </span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dslabs)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>path <span class="ot">&lt;-</span> <span class="fu">system.file</span>(<span class="st">"extdata"</span>, <span class="at">package =</span> <span class="st">"dslabs"</span>)</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>filename <span class="ot">&lt;-</span> <span class="fu">file.path</span>(path, <span class="st">"fertility-two-countries-example.csv"</span>)</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>wide_data <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(filename)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="pivot_longer" class="level3" data-number="13.1.1">
<h3 data-number="13.1.1" class="anchored" data-anchor-id="pivot_longer"><span class="header-section-number">13.1.1</span> <code>pivot_longer</code></h3>
<div class="cell" data-hash="13-wrangling_cache/html/unnamed-chunk-4_b31c888765c356b18ce406ac2fef7723">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>wide_data <span class="sc">|&gt;</span> <span class="fu">pivot_longer</span>(<span class="st">`</span><span class="at">1960</span><span class="st">`</span><span class="sc">:</span><span class="st">`</span><span class="at">2015</span><span class="st">`</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 112 × 3
   country name  value
   &lt;chr&gt;   &lt;chr&gt; &lt;dbl&gt;
 1 Germany 1960   2.41
 2 Germany 1961   2.44
 3 Germany 1962   2.47
 4 Germany 1963   2.49
 5 Germany 1964   2.49
 6 Germany 1965   2.48
 7 Germany 1966   2.44
 8 Germany 1967   2.37
 9 Germany 1968   2.28
10 Germany 1969   2.17
# ℹ 102 more rows</code></pre>
</div>
</div>
<p>We can also use the pipe like this:</p>
<div class="cell" data-hash="13-wrangling_cache/html/unnamed-chunk-5_6da7dbf9bb033d94daa6af6a7350be60">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>new_tidy_data <span class="ot">&lt;-</span> wide_data <span class="sc">|&gt;</span> </span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="st">`</span><span class="at">1960</span><span class="st">`</span><span class="sc">:</span><span class="st">`</span><span class="at">2015</span><span class="st">`</span>, <span class="at">names_to =</span> <span class="st">"year"</span>, <span class="at">values_to =</span> <span class="st">"fertility"</span>)</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(new_tidy_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 3
  country year  fertility
  &lt;chr&gt;   &lt;chr&gt;     &lt;dbl&gt;
1 Germany 1960       2.41
2 Germany 1961       2.44
3 Germany 1962       2.47
4 Germany 1963       2.49
5 Germany 1964       2.49
6 Germany 1965       2.48</code></pre>
</div>
</div>
<p>Usually its easier to name the columns not to be pivoted.</p>
<div class="cell" data-hash="13-wrangling_cache/html/unnamed-chunk-6_2efdaea6eddbb21cf0914c20d3bec50b">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>new_tidy_data <span class="ot">&lt;-</span> wide_data <span class="sc">|&gt;</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span>country, <span class="at">names_to =</span> <span class="st">"year"</span>, <span class="at">values_to =</span> <span class="st">"fertility"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The <code>new_tidy_data</code> object looks like the original <code>tidy_data</code> we defined this way</p>
<div class="cell" data-hash="13-wrangling_cache/html/unnamed-chunk-7_5d44a96fdeefb4f5ab19ed28a9e9044f">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>tidy_data <span class="ot">&lt;-</span> gapminder <span class="sc">|&gt;</span> </span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(country <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"South Korea"</span>, <span class="st">"Germany"</span>) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(fertility)) <span class="sc">|&gt;</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(country, year, fertility)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>with just one minor difference. Can you spot it? Look at the data type of the year column:</p>
<div class="cell" data-hash="13-wrangling_cache/html/unnamed-chunk-8_30a938f698c2b64a606584ddc36342bc">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(tidy_data<span class="sc">$</span>year)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "integer"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(new_tidy_data<span class="sc">$</span>year)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "character"</code></pre>
</div>
</div>
<p>The <code>pivot_longer</code> function assumes that column names are characters. So we need a bit more wrangling before we are ready to make a plot. We need to convert the year column to be numbers:</p>
<div class="cell" data-hash="13-wrangling_cache/html/unnamed-chunk-9_dc14be138bbb1276720df7fb61419f0e">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>new_tidy_data <span class="ot">&lt;-</span> wide_data <span class="sc">|&gt;</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span>country, <span class="at">names_to =</span> <span class="st">"year"</span>, <span class="at">values_to =</span> <span class="st">"fertility"</span>) <span class="sc">|&gt;</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">year =</span> <span class="fu">as.integer</span>(year))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now that the data is tidy, we can use this relatively simple ggplot code:</p>
<div class="cell" data-hash="13-wrangling_cache/html/fertility-year-check_eb282b74ed92a96a5f9325bfdd9eb7cf">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>new_tidy_data <span class="sc">|&gt;</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(year, fertility, <span class="at">color =</span> country)) <span class="sc">+</span> </span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="pivot_wider" class="level3" data-number="13.1.2">
<h3 data-number="13.1.2" class="anchored" data-anchor-id="pivot_wider"><span class="header-section-number">13.1.2</span> <code>pivot_wider</code></h3>
<div class="cell" data-hash="13-wrangling_cache/html/unnamed-chunk-10_fb65f6706a23e2d0f31ca60705d0b7fb">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>new_wide_data <span class="ot">&lt;-</span> new_tidy_data <span class="sc">|&gt;</span> </span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> year, <span class="at">values_from =</span> fertility)</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="fu">select</span>(new_wide_data, country, <span class="st">`</span><span class="at">1960</span><span class="st">`</span><span class="sc">:</span><span class="st">`</span><span class="at">1967</span><span class="st">`</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 9
  country     `1960` `1961` `1962` `1963` `1964` `1965` `1966` `1967`
  &lt;chr&gt;        &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;
1 Germany       2.41   2.44   2.47   2.49   2.49   2.48   2.44   2.37
2 South Korea   6.16   5.99   5.79   5.57   5.36   5.16   4.99   4.85</code></pre>
</div>
</div>
<p>Similar to <code>pivot_wider</code>, <code>names_from</code> and <code>values_from</code> default to <code>name</code> and <code>value</code>.</p>
</section>
<section id="sec-separate" class="level3" data-number="13.1.3">
<h3 data-number="13.1.3" class="anchored" data-anchor-id="sec-separate"><span class="header-section-number">13.1.3</span> <code>separate</code></h3>
<p>The data wrangling shown above was simple compared to what is usually required. In our example spreadsheet files, we include an illustration that is slightly more complicated. It contains two variables: life expectancy and fertility. However, the way it is stored is not tidy and, as we will explain, not optimal.</p>
<div class="cell" data-hash="13-wrangling_cache/html/unnamed-chunk-11_52a3030fe7a65053c3163a4b852d0cc0">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>path <span class="ot">&lt;-</span> <span class="fu">system.file</span>(<span class="st">"extdata"</span>, <span class="at">package =</span> <span class="st">"dslabs"</span>)</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>filename <span class="ot">&lt;-</span> <span class="st">"life-expectancy-and-fertility-two-countries-example.csv"</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>filename <span class="ot">&lt;-</span>  <span class="fu">file.path</span>(path, filename)</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>raw_dat <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(filename)</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a><span class="fu">select</span>(raw_dat, <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 5
  country     `1960_fertility` `1960_life_expectancy` `1961_fertility`
  &lt;chr&gt;                  &lt;dbl&gt;                  &lt;dbl&gt;            &lt;dbl&gt;
1 Germany                 2.41                   69.3             2.44
2 South Korea             6.16                   53.0             5.99
# ℹ 1 more variable: `1961_life_expectancy` &lt;dbl&gt;</code></pre>
</div>
</div>
<div class="cell" data-hash="13-wrangling_cache/html/unnamed-chunk-12_f31083bb0f14054822fe4393472fe8a4">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> raw_dat <span class="sc">|&gt;</span> <span class="fu">pivot_longer</span>(<span class="sc">-</span>country)</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(dat)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 3
  country name                 value
  &lt;chr&gt;   &lt;chr&gt;                &lt;dbl&gt;
1 Germany 1960_fertility        2.41
2 Germany 1960_life_expectancy 69.3 
3 Germany 1961_fertility        2.44
4 Germany 1961_life_expectancy 69.8 
5 Germany 1962_fertility        2.47
6 Germany 1962_life_expectancy 70.0 </code></pre>
</div>
</div>
<p>The result is not exactly what we refer to as tidy since each observation is associated with two, not one, rows. We want to have the values from the two variables, fertility and life expectancy, in two separate columns. The first challenge to achieve this is to separate the <code>name</code> column into the year and the variable type. Notice that the entries in this column separate the year from the variable name with an underscore:</p>
<div class="cell" data-hash="13-wrangling_cache/html/unnamed-chunk-13_c4e06024b8cc11cb23d84c667413c963">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>dat<span class="sc">$</span>name[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "1960_fertility"       "1960_life_expectancy" "1961_fertility"      
[4] "1961_life_expectancy" "1962_fertility"      </code></pre>
</div>
</div>
<p>Encoding multiple variables in a column name is such a common problem that the <strong>readr</strong> package includes a function to separate these columns into two or more. Apart from the data, the <code>separate</code> function takes three arguments: the name of the column to be separated, the names to be used for the new columns, and the character that separates the variables. So, a first attempt at this is:</p>
<div class="cell" data-hash="13-wrangling_cache/html/unnamed-chunk-14_12c3fad3e81e455eabb0f158fdaa5f6a">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>dat <span class="sc">|&gt;</span> <span class="fu">separate</span>(name, <span class="fu">c</span>(<span class="st">"year"</span>, <span class="st">"name"</span>), <span class="st">"_"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Because <code>_</code> is the default separator assumed by <code>separate</code>, we do not have to include it in the code:</p>
<div class="cell" data-hash="13-wrangling_cache/html/unnamed-chunk-15_8659c0c666bf560eab82ce67c51b9759">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>dat <span class="sc">|&gt;</span> <span class="fu">separate</span>(name, <span class="fu">c</span>(<span class="st">"year"</span>, <span class="st">"name"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Expected 2 pieces. Additional pieces discarded in 112 rows [2, 4, 6, 8, 10, 12,
14, 16, 18, 20, 22, 24, 26, 28, 30, 32, 34, 36, 38, 40, ...].</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 224 × 4
   country year  name      value
   &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt;     &lt;dbl&gt;
 1 Germany 1960  fertility  2.41
 2 Germany 1960  life      69.3 
 3 Germany 1961  fertility  2.44
 4 Germany 1961  life      69.8 
 5 Germany 1962  fertility  2.47
 6 Germany 1962  life      70.0 
 7 Germany 1963  fertility  2.49
 8 Germany 1963  life      70.1 
 9 Germany 1964  fertility  2.49
10 Germany 1964  life      70.7 
# ℹ 214 more rows</code></pre>
</div>
</div>
<p>We get a warning. Here we tell it to fill the column on the right:</p>
<div class="cell" data-hash="13-wrangling_cache/html/unnamed-chunk-16_57e114d68b5b5d0b4ae311a7fad891e3">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>var_names <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"year"</span>, <span class="st">"first_variable_name"</span>, <span class="st">"second_variable_name"</span>)</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>dat <span class="sc">|&gt;</span> <span class="fu">separate</span>(name, var_names, <span class="at">fill =</span> <span class="st">"right"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 224 × 5
   country year  first_variable_name second_variable_name value
   &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt;               &lt;chr&gt;                &lt;dbl&gt;
 1 Germany 1960  fertility           &lt;NA&gt;                  2.41
 2 Germany 1960  life                expectancy           69.3 
 3 Germany 1961  fertility           &lt;NA&gt;                  2.44
 4 Germany 1961  life                expectancy           69.8 
 5 Germany 1962  fertility           &lt;NA&gt;                  2.47
 6 Germany 1962  life                expectancy           70.0 
 7 Germany 1963  fertility           &lt;NA&gt;                  2.49
 8 Germany 1963  life                expectancy           70.1 
 9 Germany 1964  fertility           &lt;NA&gt;                  2.49
10 Germany 1964  life                expectancy           70.7 
# ℹ 214 more rows</code></pre>
</div>
</div>
<p>However, if we read the <code>separate</code> help file, we find that a better approach is to merge the last two variables when there is an extra separation:</p>
<div class="cell" data-hash="13-wrangling_cache/html/unnamed-chunk-17_caeb4a124f9bf024597edfff26daf760">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>dat <span class="sc">|&gt;</span> <span class="fu">separate</span>(name, <span class="fu">c</span>(<span class="st">"year"</span>, <span class="st">"name"</span>), <span class="at">extra =</span> <span class="st">"merge"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 224 × 4
   country year  name            value
   &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt;           &lt;dbl&gt;
 1 Germany 1960  fertility        2.41
 2 Germany 1960  life_expectancy 69.3 
 3 Germany 1961  fertility        2.44
 4 Germany 1961  life_expectancy 69.8 
 5 Germany 1962  fertility        2.47
 6 Germany 1962  life_expectancy 70.0 
 7 Germany 1963  fertility        2.49
 8 Germany 1963  life_expectancy 70.1 
 9 Germany 1964  fertility        2.49
10 Germany 1964  life_expectancy 70.7 
# ℹ 214 more rows</code></pre>
</div>
</div>
<p>This achieves the separation we wanted. However, we are not done yet. We need to create a column for each variable. As we learned, the <code>pivot_wider</code> function can do this:</p>
<div class="cell" data-hash="13-wrangling_cache/html/unnamed-chunk-18_a68ea8519880bd36053693569dd96882">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>dat <span class="sc">|&gt;</span> </span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(name, <span class="fu">c</span>(<span class="st">"year"</span>, <span class="st">"name"</span>), <span class="at">extra =</span> <span class="st">"merge"</span>) <span class="sc">|&gt;</span></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>() <span class="sc">|&gt;</span></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">year =</span> <span class="fu">as.integer</span>(year)) <span class="sc">|&gt;</span></span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(fertility, life_expectancy, <span class="at">color =</span> country)) <span class="sc">+</span> <span class="fu">geom_point</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="13-wrangling_files/figure-html/unnamed-chunk-18-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>The data is now in tidy format with one row for each observation with three variables: year, fertility, and life expectancy.</p>
</section>
<section id="unite" class="level3" data-number="13.1.4">
<h3 data-number="13.1.4" class="anchored" data-anchor-id="unite"><span class="header-section-number">13.1.4</span> <code>unite</code></h3>
<p>It is sometimes useful to do the inverse of <code>separate</code>, unite two columns into one. To demonstrate how to use <code>unite</code>, we show code that, although <em>not</em> the optimal approach, serves as an illustration. Suppose that we did not know about <code>extra</code> and used this command to separate:</p>
<div class="cell" data-hash="13-wrangling_cache/html/unnamed-chunk-19_14e7a2df9992b52702368bdaa6782258">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>var_names <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"year"</span>, <span class="st">"first_variable_name"</span>, <span class="st">"second_variable_name"</span>)</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>dat <span class="sc">|&gt;</span> </span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(name, var_names, <span class="at">fill =</span> <span class="st">"right"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 224 × 5
   country year  first_variable_name second_variable_name value
   &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt;               &lt;chr&gt;                &lt;dbl&gt;
 1 Germany 1960  fertility           &lt;NA&gt;                  2.41
 2 Germany 1960  life                expectancy           69.3 
 3 Germany 1961  fertility           &lt;NA&gt;                  2.44
 4 Germany 1961  life                expectancy           69.8 
 5 Germany 1962  fertility           &lt;NA&gt;                  2.47
 6 Germany 1962  life                expectancy           70.0 
 7 Germany 1963  fertility           &lt;NA&gt;                  2.49
 8 Germany 1963  life                expectancy           70.1 
 9 Germany 1964  fertility           &lt;NA&gt;                  2.49
10 Germany 1964  life                expectancy           70.7 
# ℹ 214 more rows</code></pre>
</div>
</div>
<p>We can achieve the same final result by uniting the second and third columns, then pivoting the columns and renaming <code>fertility_NA</code> to <code>fertility</code>:</p>
<div class="cell" data-hash="13-wrangling_cache/html/unnamed-chunk-20_4d32bbe77b32e68f09d74ce2f8d18c8f">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>dat <span class="sc">|&gt;</span> </span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(name, var_names, <span class="at">fill =</span> <span class="st">"right"</span>) <span class="sc">|&gt;</span></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unite</span>(name, first_variable_name, second_variable_name) <span class="sc">|&gt;</span></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>() <span class="sc">|&gt;</span></span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">fertility =</span> fertility_NA)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 112 × 4
   country year  fertility life_expectancy
   &lt;chr&gt;   &lt;chr&gt;     &lt;dbl&gt;           &lt;dbl&gt;
 1 Germany 1960       2.41            69.3
 2 Germany 1961       2.44            69.8
 3 Germany 1962       2.47            70.0
 4 Germany 1963       2.49            70.1
 5 Germany 1964       2.49            70.7
 6 Germany 1965       2.48            70.6
 7 Germany 1966       2.44            70.8
 8 Germany 1967       2.37            71.0
 9 Germany 1968       2.28            70.6
10 Germany 1969       2.17            70.5
# ℹ 102 more rows</code></pre>
</div>
</div>
</section>
</section>
<section id="joining-tables" class="level2" data-number="13.2">
<h2 data-number="13.2" class="anchored" data-anchor-id="joining-tables"><span class="header-section-number">13.2</span> Joining tables</h2>
<p>The information we need for a given analysis may not be just in one table. For example, when forecasting elections we used the function <code>left_join</code> to combine the information from two tables. Here we use a simpler example to illustrate the general challenge of combining tables.</p>
<p>Suppose we want to explore the relationship between population size for US states and electoral votes. We have the population size in this table:</p>
<div class="cell" data-hash="13-wrangling_cache/html/unnamed-chunk-22_b9dea802c189bcbbac10a9202064627d">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dslabs)</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(murders)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       state abb region population total
1    Alabama  AL  South    4779736   135
2     Alaska  AK   West     710231    19
3    Arizona  AZ   West    6392017   232
4   Arkansas  AR  South    2915918    93
5 California  CA   West   37253956  1257
6   Colorado  CO   West    5029196    65</code></pre>
</div>
</div>
<p>and electoral votes in this one:</p>
<div class="cell" data-hash="13-wrangling_cache/html/unnamed-chunk-23_3d4237dde0010fc1ee1aa4a560e0c24c">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(results_us_election_2016)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         state electoral_votes clinton trump others
1   California              55    61.7  31.6    6.7
2        Texas              38    43.2  52.2    4.5
3      Florida              29    47.8  49.0    3.2
4     New York              29    59.0  36.5    4.5
5     Illinois              20    55.8  38.8    5.4
6 Pennsylvania              20    47.9  48.6    3.6</code></pre>
</div>
</div>
<p>Just concatenating these two tables together will not work since the order of the states is not the same.</p>
<div class="cell" data-hash="13-wrangling_cache/html/unnamed-chunk-24_f49b0ec8644e950445fa22374383fe2a">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="fu">identical</span>(results_us_election_2016<span class="sc">$</span>state, murders<span class="sc">$</span>state)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] FALSE</code></pre>
</div>
</div>
<p>The <em>join</em> functions, described below, are designed to handle this challenge.</p>
<section id="sec-joins" class="level3" data-number="13.2.1">
<h3 data-number="13.2.1" class="anchored" data-anchor-id="sec-joins"><span class="header-section-number">13.2.1</span> Joins</h3>
<p>The <em>join</em> functions in the <strong>dplyr</strong> package make sure that the tables are combined so that matching rows are together. If you know SQL, you will see that the approach and syntax is very similar. The general idea is that one needs to identify one or more columns that will serve to match the two tables. Then a new table with the combined information is returned. Notice what happens if we join the two tables above by state using <code>left_join</code> (we will remove the <code>others</code> column and rename <code>electoral_votes</code> so that the tables fit on the page):</p>
<div class="cell" data-hash="13-wrangling_cache/html/unnamed-chunk-25_42361b8254b8612bca67962af59877e0">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>tab <span class="ot">&lt;-</span> <span class="fu">left_join</span>(murders, results_us_election_2016, <span class="at">by =</span> <span class="st">"state"</span>) <span class="sc">|&gt;</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>others) <span class="sc">|&gt;</span> <span class="fu">rename</span>(<span class="at">ev =</span> electoral_votes)</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(tab)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       state abb region population total ev clinton trump
1    Alabama  AL  South    4779736   135  9    34.4  62.1
2     Alaska  AK   West     710231    19  3    36.6  51.3
3    Arizona  AZ   West    6392017   232 11    45.1  48.7
4   Arkansas  AR  South    2915918    93  6    33.7  60.6
5 California  CA   West   37253956  1257 55    61.7  31.6
6   Colorado  CO   West    5029196    65  9    48.2  43.3</code></pre>
</div>
</div>
<p>The data has been successfully joined and we can now, for example, make a plot to explore the relationship:</p>
<div class="cell" data-hash="13-wrangling_cache/html/ev-vs-population_e1e7b2409aec0e2eef48ff833e63a536">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggrepel)</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>tab <span class="sc">|&gt;</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(population<span class="sc">/</span><span class="dv">10</span><span class="sc">^</span><span class="dv">6</span>, ev)) <span class="sc">+</span></span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text_repel</span>(<span class="fu">aes</span>(<span class="at">label =</span> abb), <span class="at">max.overlaps =</span> <span class="dv">20</span>) <span class="sc">+</span> </span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">trans =</span> <span class="st">"log2"</span>) <span class="sc">+</span></span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">trans =</span> <span class="st">"log2"</span>) <span class="sc">+</span></span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="13-wrangling_files/figure-html/ev-vs-population-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>We see the relationship is close to linear with about 2 electoral votes for every million persons, but with very small states getting higher ratios.</p>
<p>In practice, it is not always the case that each row in one table has a matching row in the other. For this reason, we have several versions of join. To illustrate this challenge, we will take subsets of the tables above. We create the tables <code>tab1</code> and <code>tab2</code> so that they have some states in common but not all:</p>
<div class="cell" data-hash="13-wrangling_cache/html/unnamed-chunk-26_b063794c771d3189c647496b7356489e">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>tab_1 <span class="ot">&lt;-</span> <span class="fu">slice</span>(murders, <span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>) <span class="sc">|&gt;</span> <span class="fu">select</span>(state, population)</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>tab_1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       state population
1    Alabama    4779736
2     Alaska     710231
3    Arizona    6392017
4   Arkansas    2915918
5 California   37253956
6   Colorado    5029196</code></pre>
</div>
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>tab_2 <span class="ot">&lt;-</span> results_us_election_2016 <span class="sc">|&gt;</span> </span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(state <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Alabama"</span>, <span class="st">"Alaska"</span>, <span class="st">"Arizona"</span>, </span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"California"</span>, <span class="st">"Connecticut"</span>, <span class="st">"Delaware"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(state, electoral_votes) <span class="sc">|&gt;</span> <span class="fu">rename</span>(<span class="at">ev =</span> electoral_votes)</span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a>tab_2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        state ev
1  California 55
2     Arizona 11
3     Alabama  9
4 Connecticut  7
5      Alaska  3
6    Delaware  3</code></pre>
</div>
</div>
<p>We will use these two tables as examples in the next sections.</p>
<section id="left-join" class="level4" data-number="13.2.1.1">
<h4 data-number="13.2.1.1" class="anchored" data-anchor-id="left-join"><span class="header-section-number">13.2.1.1</span> Left join</h4>
<p>Suppose we want a table like <code>tab_1</code>, but adding electoral votes to whatever states we have available. For this, we use <code>left_join</code> with <code>tab_1</code> as the first argument. We specify which column to use to match with the <code>by</code> argument.</p>
<div class="cell" data-hash="13-wrangling_cache/html/unnamed-chunk-27_8f6c5da6e7dbd3fe27350aba42ee31ce">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="fu">left_join</span>(tab_1, tab_2, <span class="at">by =</span> <span class="st">"state"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       state population ev
1    Alabama    4779736  9
2     Alaska     710231  3
3    Arizona    6392017 11
4   Arkansas    2915918 NA
5 California   37253956 55
6   Colorado    5029196 NA</code></pre>
</div>
</div>
<p>Note that <code>NA</code>s are added to the two states not appearing in <code>tab_2</code>. Also, notice that this function, as well as all the other joins, can receive the first arguments through the pipe:</p>
<div class="cell" data-hash="13-wrangling_cache/html/unnamed-chunk-28_9ae44c19bf077b4d60129b11b83fad54">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>tab_1 <span class="sc">|&gt;</span> <span class="fu">left_join</span>(tab_2, <span class="at">by =</span> <span class="st">"state"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="right-join" class="level4" data-number="13.2.1.2">
<h4 data-number="13.2.1.2" class="anchored" data-anchor-id="right-join"><span class="header-section-number">13.2.1.2</span> Right join</h4>
<p>If instead of a table with the same rows as first table, we want one with the same rows as second table, we can use <code>right_join</code>:</p>
<div class="cell" data-hash="13-wrangling_cache/html/unnamed-chunk-29_e6c1f29fa9ab56c200a0d0838f886015">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>tab_1 <span class="sc">|&gt;</span> <span class="fu">right_join</span>(tab_2, <span class="at">by =</span> <span class="st">"state"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        state population ev
1     Alabama    4779736  9
2      Alaska     710231  3
3     Arizona    6392017 11
4  California   37253956 55
5 Connecticut         NA  7
6    Delaware         NA  3</code></pre>
</div>
</div>
<p>Now the NAs are in the column coming from <code>tab_1</code>.</p>
</section>
<section id="inner-join" class="level4" data-number="13.2.1.3">
<h4 data-number="13.2.1.3" class="anchored" data-anchor-id="inner-join"><span class="header-section-number">13.2.1.3</span> Inner join</h4>
<p>If we want to keep only the rows that have information in both tables, we use <code>inner_join</code>. You can think of this as an intersection:</p>
<div class="cell" data-hash="13-wrangling_cache/html/unnamed-chunk-30_b96069523cf22385bdca5624e6a30c40">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="fu">inner_join</span>(tab_1, tab_2, <span class="at">by =</span> <span class="st">"state"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       state population ev
1    Alabama    4779736  9
2     Alaska     710231  3
3    Arizona    6392017 11
4 California   37253956 55</code></pre>
</div>
</div>
</section>
<section id="full-join" class="level4" data-number="13.2.1.4">
<h4 data-number="13.2.1.4" class="anchored" data-anchor-id="full-join"><span class="header-section-number">13.2.1.4</span> Full join</h4>
<p>If we want to keep all the rows and fill the missing parts with NAs, we can use <code>full_join</code>. You can think of this as a union:</p>
<div class="cell" data-hash="13-wrangling_cache/html/unnamed-chunk-31_5c6f5aa8b6e2561867a5ee947806be9b">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="fu">full_join</span>(tab_1, tab_2, <span class="at">by =</span> <span class="st">"state"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        state population ev
1     Alabama    4779736  9
2      Alaska     710231  3
3     Arizona    6392017 11
4    Arkansas    2915918 NA
5  California   37253956 55
6    Colorado    5029196 NA
7 Connecticut         NA  7
8    Delaware         NA  3</code></pre>
</div>
</div>
</section>
<section id="semi-join" class="level4" data-number="13.2.1.5">
<h4 data-number="13.2.1.5" class="anchored" data-anchor-id="semi-join"><span class="header-section-number">13.2.1.5</span> Semi join</h4>
<p>The <code>semi_join</code> function lets us keep the part of first table for which we have information in the second. It does not add the columns of the second:</p>
<div class="cell" data-hash="13-wrangling_cache/html/unnamed-chunk-32_5c1ead5b5adb1dcd6e9952bca8aabc1c">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="fu">semi_join</span>(tab_1, tab_2, <span class="at">by =</span> <span class="st">"state"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       state population
1    Alabama    4779736
2     Alaska     710231
3    Arizona    6392017
4 California   37253956</code></pre>
</div>
</div>
</section>
<section id="anti-join" class="level4" data-number="13.2.1.6">
<h4 data-number="13.2.1.6" class="anchored" data-anchor-id="anti-join"><span class="header-section-number">13.2.1.6</span> Anti join</h4>
<p>The function <code>anti_join</code> is the opposite of <code>semi_join</code>. It keeps the elements of the first table for which there is no information in the second:</p>
<div class="cell" data-hash="13-wrangling_cache/html/unnamed-chunk-33_d01da15db206289b00d26372265b7285">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="fu">anti_join</span>(tab_1, tab_2, <span class="at">by =</span> <span class="st">"state"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     state population
1 Arkansas    2915918
2 Colorado    5029196</code></pre>
</div>
</div>
</section>
</section>
<section id="set-operators" class="level3" data-number="13.2.2">
<h3 data-number="13.2.2" class="anchored" data-anchor-id="set-operators"><span class="header-section-number">13.2.2</span> Set operators</h3>
<p>You can use set operators on data frames:</p>
<section id="intersect" class="level4" data-number="13.2.2.1">
<h4 data-number="13.2.2.1" class="anchored" data-anchor-id="intersect"><span class="header-section-number">13.2.2.1</span> Intersect</h4>
<p>You can take intersections of vectors of any type, such as numeric:</p>
<div class="cell" data-hash="13-wrangling_cache/html/unnamed-chunk-34_00c87169d90d02900e8d4a79a5171535">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="fu">intersect</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>, <span class="dv">6</span><span class="sc">:</span><span class="dv">15</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1]  6  7  8  9 10</code></pre>
</div>
</div>
<p>or characters:</p>
<div class="cell" data-hash="13-wrangling_cache/html/unnamed-chunk-35_81b9f8569eca65196ba22351a9377391">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="fu">intersect</span>(<span class="fu">c</span>(<span class="st">"a"</span>,<span class="st">"b"</span>,<span class="st">"c"</span>), <span class="fu">c</span>(<span class="st">"b"</span>,<span class="st">"c"</span>,<span class="st">"d"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "b" "c"</code></pre>
</div>
</div>
<div class="cell" data-hash="13-wrangling_cache/html/unnamed-chunk-36_779957410184682d04d22b3fc7f79f2e">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>tab_1 <span class="ot">&lt;-</span> tab[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>,]</span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>tab_2 <span class="ot">&lt;-</span> tab[<span class="dv">3</span><span class="sc">:</span><span class="dv">7</span>,]</span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">intersect</span>(tab_1, tab_2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       state abb region population total ev clinton trump
1    Arizona  AZ   West    6392017   232 11    45.1  48.7
2   Arkansas  AR  South    2915918    93  6    33.7  60.6
3 California  CA   West   37253956  1257 55    61.7  31.6</code></pre>
</div>
</div>
</section>
<section id="union" class="level4" data-number="13.2.2.2">
<h4 data-number="13.2.2.2" class="anchored" data-anchor-id="union"><span class="header-section-number">13.2.2.2</span> Union</h4>
<p>Similarly <em>union</em> takes the union of vectors. For example:</p>
<div class="cell" data-hash="13-wrangling_cache/html/unnamed-chunk-37_0d7e56c586da33559d85fb59c9cfa68c">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="fu">union</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>, <span class="dv">6</span><span class="sc">:</span><span class="dv">15</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1]  1  2  3  4  5  6  7  8  9 10 11 12 13 14 15</code></pre>
</div>
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="fu">union</span>(<span class="fu">c</span>(<span class="st">"a"</span>,<span class="st">"b"</span>,<span class="st">"c"</span>), <span class="fu">c</span>(<span class="st">"b"</span>,<span class="st">"c"</span>,<span class="st">"d"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "a" "b" "c" "d"</code></pre>
</div>
</div>
<p>The <strong>dplyr</strong> package includes a version of <code>union</code> that combines all the rows of two tables with the same column names.</p>
<div class="cell" data-hash="13-wrangling_cache/html/unnamed-chunk-38_7235a2faa223321e1be76ecfc47f0ef5">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>tab_1 <span class="ot">&lt;-</span> tab[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>,]</span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a>tab_2 <span class="ot">&lt;-</span> tab[<span class="dv">3</span><span class="sc">:</span><span class="dv">7</span>,]</span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">union</span>(tab_1, tab_2) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        state abb    region population total ev clinton trump
1     Alabama  AL     South    4779736   135  9    34.4  62.1
2      Alaska  AK      West     710231    19  3    36.6  51.3
3     Arizona  AZ      West    6392017   232 11    45.1  48.7
4    Arkansas  AR     South    2915918    93  6    33.7  60.6
5  California  CA      West   37253956  1257 55    61.7  31.6
6    Colorado  CO      West    5029196    65  9    48.2  43.3
7 Connecticut  CT Northeast    3574097    97  7    54.6  40.9</code></pre>
</div>
</div>
</section>
<section id="setdiff" class="level4" data-number="13.2.2.3">
<h4 data-number="13.2.2.3" class="anchored" data-anchor-id="setdiff"><span class="header-section-number">13.2.2.3</span> <code>setdiff</code></h4>
<p>The set difference between a first and second argument can be obtained with <code>setdiff</code>. Unlike <code>intersect</code> and <code>union</code>, this function is not symmetric:</p>
<div class="cell" data-hash="13-wrangling_cache/html/unnamed-chunk-39_c9ebb05075225a204b40bcd9b9c27a6c">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="fu">setdiff</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>, <span class="dv">6</span><span class="sc">:</span><span class="dv">15</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1 2 3 4 5</code></pre>
</div>
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="fu">setdiff</span>(<span class="dv">6</span><span class="sc">:</span><span class="dv">15</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 11 12 13 14 15</code></pre>
</div>
</div>
<p>As with the functions shown above, <strong>dplyr</strong> has a version for data frames:</p>
<div class="cell" data-hash="13-wrangling_cache/html/unnamed-chunk-40_85d1f02cf975ee523a64d7a8c4eac8ad">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a>tab_1 <span class="ot">&lt;-</span> tab[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>,]</span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a>tab_2 <span class="ot">&lt;-</span> tab[<span class="dv">3</span><span class="sc">:</span><span class="dv">7</span>,]</span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">setdiff</span>(tab_1, tab_2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    state abb region population total ev clinton trump
1 Alabama  AL  South    4779736   135  9    34.4  62.1
2  Alaska  AK   West     710231    19  3    36.6  51.3</code></pre>
</div>
</div>
</section>
<section id="setequal" class="level4" data-number="13.2.2.4">
<h4 data-number="13.2.2.4" class="anchored" data-anchor-id="setequal"><span class="header-section-number">13.2.2.4</span> <code>setequal</code></h4>
<p>Finally, the function <code>setequal</code> tells us if two sets are the same, regardless of order. So notice that:</p>
<div class="cell" data-hash="13-wrangling_cache/html/unnamed-chunk-41_3366214fb298c4765493a32dc68fd749">
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a><span class="fu">setequal</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] FALSE</code></pre>
</div>
</div>
<p>but:</p>
<div class="cell" data-hash="13-wrangling_cache/html/unnamed-chunk-42_a446680af0724501db49c3cb97773ece">
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a><span class="fu">setequal</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>, <span class="dv">5</span><span class="sc">:</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
</div>
<p>When applied to data frames that are not equal, regardless of order, the <strong>dplyr</strong> version provides a useful message letting us know how the sets are different:</p>
<div class="cell" data-hash="13-wrangling_cache/html/unnamed-chunk-43_9cf51f16f21fd545bfaa47b22d916285">
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">setequal</span>(tab_1, tab_2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] FALSE</code></pre>
</div>
</div>
</section>
</section>
</section>
<section id="string-processing" class="level2" data-number="13.3">
<h2 data-number="13.3" class="anchored" data-anchor-id="string-processing"><span class="header-section-number">13.3</span> String processing</h2>
<section id="sec-stringr" class="level3" data-number="13.3.1">
<h3 data-number="13.3.1" class="anchored" data-anchor-id="sec-stringr"><span class="header-section-number">13.3.1</span> The stringr package</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stringr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="case-study-self-reported-heights" class="level3" data-number="13.3.2">
<h3 data-number="13.3.2" class="anchored" data-anchor-id="case-study-self-reported-heights"><span class="header-section-number">13.3.2</span> Case study: self-reported heights</h3>
<p>The <strong>dslabs</strong> package includes the raw data from which the heights dataset was obtained. You can load it like this:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dslabs)</span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(reported_heights)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>           time_stamp    sex height
1 2014-09-02 13:40:36   Male     75
2 2014-09-02 13:46:59   Male     70
3 2014-09-02 13:59:20   Male     68
4 2014-09-02 14:51:53   Male     74
5 2014-09-02 15:16:15   Male     61
6 2014-09-02 15:16:16 Female     65</code></pre>
</div>
</div>
<div class="cell" data-hash="13-wrangling_cache/html/unnamed-chunk-46_411814d429a6ed14ca5119a19c6f5311">
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(reported_heights<span class="sc">$</span>height)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "character"</code></pre>
</div>
</div>
<p>If we try to parse it into numbers, we get a warning:</p>
<div class="cell" data-hash="13-wrangling_cache/html/unnamed-chunk-47_cf73492d00912fa6e842382a79b5e293">
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(reported_heights<span class="sc">$</span>height)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: NAs introduced by coercion</code></pre>
</div>
</div>
<p>Although most values appear to be height in inches as requested:</p>
<div class="cell" data-hash="13-wrangling_cache/html/unnamed-chunk-48_66a9a9a0435b5c8deb880ac9416e675d">
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(x)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 75 70 68 74 61 65</code></pre>
</div>
</div>
<p>we do end up with many <code>NA</code>s:</p>
<div class="cell" data-hash="13-wrangling_cache/html/unnamed-chunk-49_82a069e761e2b44dec3d28a44392f35f">
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(<span class="fu">is.na</span>(x))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 81</code></pre>
</div>
</div>
<p>We can see some of the entries that are not successfully converted by using <code>filter</code> to keep only the entries resulting in <code>NA</code>s:</p>
<div class="cell" data-hash="13-wrangling_cache/html/unnamed-chunk-50_c2b479f55f513e517a04ddd78059b027">
<div class="sourceCode cell-code" id="cb100"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a>reported_heights <span class="sc">|&gt;</span> </span>
<span id="cb100-2"><a href="#cb100-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">new_height =</span> <span class="fu">as.numeric</span>(height)) <span class="sc">|&gt;</span></span>
<span id="cb100-3"><a href="#cb100-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">is.na</span>(new_height)) <span class="sc">|&gt;</span> </span>
<span id="cb100-4"><a href="#cb100-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(<span class="at">n =</span> <span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>            time_stamp    sex                 height new_height
1  2014-09-02 15:16:28   Male                  5' 4"         NA
2  2014-09-02 15:16:37 Female                  165cm         NA
3  2014-09-02 15:16:52   Male                    5'7         NA
4  2014-09-02 15:16:56   Male                  &gt;9000         NA
5  2014-09-02 15:16:56   Male                   5'7"         NA
6  2014-09-02 15:17:09 Female                   5'3"         NA
7  2014-09-02 15:18:00   Male 5 feet and 8.11 inches         NA
8  2014-09-02 15:19:48   Male                   5'11         NA
9  2014-09-04 00:46:45   Male                  5'9''         NA
10 2014-09-04 10:29:44   Male                 5'10''         NA</code></pre>
</div>
</div>
<p>We permit a range that covers about 99.9999% of the adult population. We also use <code>suppressWarnings</code> to avoid the warning message we know <code>as.numeric</code> will gives us.</p>
<div class="cell" data-hash="13-wrangling_cache/html/unnamed-chunk-52_d460b9b35d4b9f77953a3d0358e6b40c">
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a>not_inches <span class="ot">&lt;-</span> <span class="cf">function</span>(x, <span class="at">smallest =</span> <span class="dv">50</span>, <span class="at">tallest =</span> <span class="dv">84</span>){</span>
<span id="cb102-2"><a href="#cb102-2" aria-hidden="true" tabindex="-1"></a>  inches <span class="ot">&lt;-</span> <span class="fu">suppressWarnings</span>(<span class="fu">as.numeric</span>(x))</span>
<span id="cb102-3"><a href="#cb102-3" aria-hidden="true" tabindex="-1"></a>  ind <span class="ot">&lt;-</span> <span class="fu">is.na</span>(inches) <span class="sc">|</span> inches <span class="sc">&lt;</span> smallest <span class="sc">|</span> inches <span class="sc">&gt;</span> tallest</span>
<span id="cb102-4"><a href="#cb102-4" aria-hidden="true" tabindex="-1"></a>  ind</span>
<span id="cb102-5"><a href="#cb102-5" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We apply this function and find the number of problematic entries:</p>
<div class="cell" data-hash="13-wrangling_cache/html/unnamed-chunk-53_9d9f1b861974f1db86994b65fe1f4215">
<div class="sourceCode cell-code" id="cb103"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a>problems <span class="ot">&lt;-</span> reported_heights <span class="sc">|&gt;</span> </span>
<span id="cb103-2"><a href="#cb103-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">not_inches</span>(height)) <span class="sc">|&gt;</span></span>
<span id="cb103-3"><a href="#cb103-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(height)</span>
<span id="cb103-4"><a href="#cb103-4" aria-hidden="true" tabindex="-1"></a>problems</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  [1] "6"                      "5' 4\""                 "5.3"                   
  [4] "165cm"                  "511"                    "6"                     
  [7] "2"                      "5'7"                    "&gt;9000"                 
 [10] "5'7\""                  "5'3\""                  "5 feet and 8.11 inches"
 [13] "5.25"                   "5'11"                   "5.5"                   
 [16] "11111"                  "5'9''"                  "6"                     
 [19] "6.5"                    "150"                    "5'10''"                
 [22] "103.2"                  "5.8"                    "19"                    
 [25] "5"                      "5.6"                    "175"                   
 [28] "177"                    "300"                    "5,3"                   
 [31] "6'"                     "6"                      "5.9"                   
 [34] "6,8"                    "5' 10"                  "5.5"                   
 [37] "178"                    "163"                    "6.2"                   
 [40] "175"                    "Five foot eight inches" "6.2"                   
 [43] "5.8"                    "5.1"                    "178"                   
 [46] "165"                    "5.11"                   "5'5\""                 
 [49] "165"                    "180"                    "5'2\""                 
 [52] "5.75"                   "169"                    "5,4"                   
 [55] "7"                      "5.4"                    "157"                   
 [58] "6.1"                    "169"                    "5'3"                   
 [61] "5.6"                    "214"                    "183"                   
 [64] "5.6"                    "6"                      "162"                   
 [67] "178"                    "180"                    "5'10''"                
 [70] "170"                    "5'3''"                  "178"                   
 [73] "0.7"                    "190"                    "5.4"                   
 [76] "184"                    "5'7''"                  "5.9"                   
 [79] "5'12"                   "5.6"                    "5.6"                   
 [82] "184"                    "6"                      "167"                   
 [85] "2'33"                   "5'11"                   "5'3\""                 
 [88] "5.5"                    "5.2"                    "180"                   
 [91] "5.5"                    "5.5"                    "6.5"                   
 [94] "5,8"                    "180"                    "183"                   
 [97] "170"                    "5'6''"                  "172"                   
[100] "612"                    "5.11"                   "168"                   
[103] "5'4"                    "1,70"                   "172"                   
[106] "87"                     "5.5"                    "176"                   
[109] "5'7.5''"                "5'7.5''"                "111"                   
[112] "5'2\""                  "173"                    "174"                   
[115] "176"                    "175"                    "5' 7.78\""             
[118] "6.7"                    "12"                     "6"                     
[121] "5.1"                    "5.6"                    "5.5"                   
[124] "yyy"                    "5.2"                    "5'5"                   
[127] "5'8"                    "5'6"                    "5 feet 7inches"        
[130] "89"                     "5.6"                    "5.7"                   
[133] "183"                    "172"                    "34"                    
[136] "25"                     "6"                      "5.9"                   
[139] "168"                    "6.5"                    "170"                   
[142] "175"                    "6"                      "22"                    
[145] "5.11"                   "684"                    "6"                     
[148] "1"                      "1"                      "6*12"                  
[151] "5 .11"                  "87"                     "162"                   
[154] "165"                    "184"                    "6"                     
[157] "173"                    "1.6"                    "172"                   
[160] "170"                    "5.7"                    "5.5"                   
[163] "174"                    "170"                    "160"                   
[166] "120"                    "120"                    "23"                    
[169] "192"                    "5 11"                   "167"                   
[172] "150"                    "1.7"                    "174"                   
[175] "5.8"                    "6"                      "5'4"                   
[178] "5'8\""                  "5'5"                    "5.8"                   
[181] "5.1"                    "5.11"                   "5.7"                   
[184] "5'7"                    "5'6"                    "5'11\""                
[187] "5'7\""                  "5'7"                    "172"                   
[190] "5'8"                    "180"                    "5' 11\""               
[193] "5"                      "180"                    "180"                   
[196] "6'1\""                  "5.9"                    "5.2"                   
[199] "5.5"                    "69\""                   "5' 7\""                
[202] "5'10''"                 "5.51"                   "5'10"                  
[205] "5'10"                   "5ft 9 inches"           "5 ft 9 inches"         
[208] "5'2"                    "5'11"                   "5.8"                   
[211] "5.7"                    "167"                    "168"                   
[214] "6"                      "6.1"                    "5'11''"                
[217] "5.69"                   "178"                    "182"                   
[220] "164"                    "5'8\""                  "185"                   
[223] "6"                      "86"                     "5.7"                   
[226] "708,661"                "5.25"                   "5.5"                   
[229] "5 feet 6 inches"        "5'10''"                 "172"                   
[232] "6"                      "5'8"                    "160"                   
[235] "6'3\""                  "649,606"                "10000"                 
[238] "5.1"                    "152"                    "1"                     
[241] "180"                    "728,346"                "175"                   
[244] "158"                    "173"                    "164"                   
[247] "6 04"                   "169"                    "0"                     
[250] "185"                    "168"                    "5'9"                   
[253] "169"                    "5'5''"                  "174"                   
[256] "6.3"                    "179"                    "5'7\""                 
[259] "5.5"                    "6"                      "6"                     
[262] "170"                    "6"                      "172"                   
[265] "158"                    "100"                    "159"                   
[268] "190"                    "5.7"                    "170"                   
[271] "158"                    "6'4\""                  "180"                   
[274] "5.57"                   "5'4"                    "210"                   
[277] "88"                     "6"                      "162"                   
[280] "170 cm"                 "5.7"                    "170"                   
[283] "157"                    "186"                    "170"                   
[286] "7,283,465"              "5"                      "5"                     
[289] "34"                     "161"                    "5'6"                   
[292] "5'6"                   </code></pre>
</div>
</div>
</section>
<section id="regular-expressions" class="level3" data-number="13.3.3">
<h3 data-number="13.3.3" class="anchored" data-anchor-id="regular-expressions"><span class="header-section-number">13.3.3</span> Regular expressions</h3>
<section id="special-characters" class="level4" data-number="13.3.3.1">
<h4 data-number="13.3.3.1" class="anchored" data-anchor-id="special-characters"><span class="header-section-number">13.3.3.1</span> Special characters</h4>
<p>Now let’s consider a slightly more complicated example. Which of the following strings contain the pattern <code>cm</code> or <code>inches</code>?</p>
<div class="cell" data-hash="13-wrangling_cache/html/unnamed-chunk-54_63a7484088a6f8a647fdd5bbc4962bed">
<div class="sourceCode cell-code" id="cb105"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a>yes <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"180 cm"</span>, <span class="st">"70 inches"</span>)</span>
<span id="cb105-2"><a href="#cb105-2" aria-hidden="true" tabindex="-1"></a>no <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"180"</span>, <span class="st">"70''"</span>)</span>
<span id="cb105-3"><a href="#cb105-3" aria-hidden="true" tabindex="-1"></a>s <span class="ot">&lt;-</span> <span class="fu">c</span>(yes, no)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-hash="13-wrangling_cache/html/unnamed-chunk-55_f9612efe8e272ea41e297fda080ace77">
<div class="sourceCode cell-code" id="cb106"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_detect</span>(s, <span class="st">"cm"</span>) <span class="sc">|</span> <span class="fu">str_detect</span>(s, <span class="st">"inches"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1]  TRUE  TRUE FALSE FALSE</code></pre>
</div>
</div>
<p>However, we don’t need to do this. The main feature that distinguishes the regex <em>language</em> from plain strings is that we can use special characters. These are characters with a meaning. We start by introducing <code>|</code> which means <em>or</em>. So if we want to know if either <code>cm</code> or <code>inches</code> appears in the strings, we can use the regex <code>cm|inches</code>:</p>
<div class="cell" data-hash="13-wrangling_cache/html/unnamed-chunk-56_012e5b4998d002016432d2a240e497e0">
<div class="sourceCode cell-code" id="cb108"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_detect</span>(s, <span class="st">"cm|inches"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1]  TRUE  TRUE FALSE FALSE</code></pre>
</div>
</div>
<p>and obtain the correct answer.</p>
<p>Another special character that will be useful for identifying feet and inches values is <code>\d</code> which means any digit: 0, 1, 2, 3, 4, 5, 6, 7, 8, 9. The backslash is used to distinguish it from the character <code>d</code>. In R, we have to <em>escape</em> the backslash <code>\</code> so we actually have to use <code>\\d</code> to represent digits. Here is an example:</p>
<div class="cell" data-hash="13-wrangling_cache/html/unnamed-chunk-57_e3e9f2737a6d7c369b195be3caecd6fc">
<div class="sourceCode cell-code" id="cb110"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a>yes <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"5"</span>, <span class="st">"6"</span>, <span class="st">"5'10"</span>, <span class="st">"5 feet"</span>, <span class="st">"4'11"</span>)</span>
<span id="cb110-2"><a href="#cb110-2" aria-hidden="true" tabindex="-1"></a>no <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">""</span>, <span class="st">"."</span>, <span class="st">"Five"</span>, <span class="st">"six"</span>)</span>
<span id="cb110-3"><a href="#cb110-3" aria-hidden="true" tabindex="-1"></a>s <span class="ot">&lt;-</span> <span class="fu">c</span>(yes, no)</span>
<span id="cb110-4"><a href="#cb110-4" aria-hidden="true" tabindex="-1"></a>pattern <span class="ot">&lt;-</span> <span class="st">"</span><span class="sc">\\</span><span class="st">d"</span></span>
<span id="cb110-5"><a href="#cb110-5" aria-hidden="true" tabindex="-1"></a><span class="fu">str_detect</span>(s, pattern)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1]  TRUE  TRUE  TRUE  TRUE  TRUE FALSE FALSE FALSE FALSE</code></pre>
</div>
</div>
<p>We take this opportunity to introduce the <code>str_view_all</code> function, which is helpful for troubleshooting as it shows us the first match for each string:</p>
<div class="cell" data-hash="13-wrangling_cache/html/unnamed-chunk-58_596f0d86171ac3d3b6a8840d59d9a3bd">
<div class="sourceCode cell-code" id="cb112"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_view_all</span>(s, pattern)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: `str_view()` was deprecated in stringr 1.5.0.
ℹ Please use `str_view_all()` instead.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] │ &lt;5&gt;
[2] │ &lt;6&gt;
[3] │ &lt;5&gt;'&lt;1&gt;&lt;0&gt;
[4] │ &lt;5&gt; feet
[5] │ &lt;4&gt;'&lt;1&gt;&lt;1&gt;
[6] │ 
[7] │ .
[8] │ Five
[9] │ six</code></pre>
</div>
</div>
<p>and <code>str_view_all</code> shows us all the matches, so <code>3'2</code> has two matches and <code>5'10</code> has three.</p>
<div class="cell" data-hash="13-wrangling_cache/html/unnamed-chunk-59_66e19517eafb893ce1f6bd01c41cc2d2">
<div class="sourceCode cell-code" id="cb115"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb115-1"><a href="#cb115-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_view_all</span>(s, pattern)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] │ &lt;5&gt;
[2] │ &lt;6&gt;
[3] │ &lt;5&gt;'&lt;1&gt;&lt;0&gt;
[4] │ &lt;5&gt; feet
[5] │ &lt;4&gt;'&lt;1&gt;&lt;1&gt;
[6] │ 
[7] │ .
[8] │ Five
[9] │ six</code></pre>
</div>
</div>
<p>There are many other special characters. We will learn some others below, but you can see most or all of them in the cheat sheet<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> mentioned earlier.</p>
<p>Finally, a useful special character is <code>\w</code> which stands for <em>word character</em> and it matches any letter, number, or underscore. It is equivalent to <code>[a-zA-Z0-9_]</code>.</p>
</section>
<section id="character-classes" class="level4" data-number="13.3.3.2">
<h4 data-number="13.3.3.2" class="anchored" data-anchor-id="character-classes"><span class="header-section-number">13.3.3.2</span> Character classes</h4>
<p>Character classes are used to define a series of characters that can be matched. We define character classes with square brackets <code>[]</code>. So, for example, if we want the pattern to match only if we have a <code>5</code> or a <code>6</code>, we use the regex <code>[56]</code>:</p>
<div class="cell" data-hash="13-wrangling_cache/html/unnamed-chunk-60_69b6118fb94e71ef2011c901c274c1b8">
<div class="sourceCode cell-code" id="cb117"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb117-1"><a href="#cb117-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_view_all</span>(s, <span class="st">"[56]"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] │ &lt;5&gt;
[2] │ &lt;6&gt;
[3] │ &lt;5&gt;'10
[4] │ &lt;5&gt; feet
[5] │ 4'11
[6] │ 
[7] │ .
[8] │ Five
[9] │ six</code></pre>
</div>
</div>
<p>Suppose we want to match values between 4 and 7. A common way to define character classes is with ranges. So, for example, <code>[0-9]</code> is equivalent to <code>\\d</code>. The pattern we want is therefore <code>[4-7]</code>.</p>
<div class="cell" data-hash="13-wrangling_cache/html/unnamed-chunk-61_624037379aa6bc1ad5d67a8498ed1629">
<div class="sourceCode cell-code" id="cb119"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb119-1"><a href="#cb119-1" aria-hidden="true" tabindex="-1"></a>yes <span class="ot">&lt;-</span> <span class="fu">as.character</span>(<span class="dv">4</span><span class="sc">:</span><span class="dv">7</span>)</span>
<span id="cb119-2"><a href="#cb119-2" aria-hidden="true" tabindex="-1"></a>no <span class="ot">&lt;-</span> <span class="fu">as.character</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>)</span>
<span id="cb119-3"><a href="#cb119-3" aria-hidden="true" tabindex="-1"></a>s <span class="ot">&lt;-</span> <span class="fu">c</span>(yes, no)</span>
<span id="cb119-4"><a href="#cb119-4" aria-hidden="true" tabindex="-1"></a><span class="fu">str_detect</span>(s, <span class="st">"[4-7]"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1]  TRUE  TRUE  TRUE  TRUE FALSE FALSE FALSE</code></pre>
</div>
</div>
<p>However, it is important to know that in regex everything is a character; there are no numbers. So <code>4</code> is the character <code>4</code> not the number four. Notice, for example, that <code>[1-20]</code> does <strong>not</strong> mean 1 through 20, it means the characters 1 through 2 or the character 0. So <code>[1-20]</code> simply means the character class composed of 0, 1, and 2.</p>
<p>Keep in mind that characters do have an order and the digits do follow the numeric order. So <code>0</code> comes before <code>1</code> which comes before <code>2</code> and so on. For the same reason, we can define lower case letters as <code>[a-z]</code>, upper case letters as <code>[A-Z]</code>, and <code>[a-zA-z]</code> as both.</p>
</section>
<section id="anchors" class="level4" data-number="13.3.3.3">
<h4 data-number="13.3.3.3" class="anchored" data-anchor-id="anchors"><span class="header-section-number">13.3.3.3</span> Anchors</h4>
<p>What if we want a match when we have exactly 1 digit? This will be useful in our case study since feet are never more than 1 digit so a restriction will help us. One way to do this with regex is by using <em>anchors</em>, which let us define patterns that must start or end at a specific place. The two most common anchors are <code>^</code> and <code>$</code> which represent the beginning and end of a string, respectively. So the pattern <code>^\\d$</code> is read as “start of the string followed by one digit followed by end of string”.</p>
<p>This pattern now only detects the strings with exactly one digit:</p>
<div class="cell" data-hash="13-wrangling_cache/html/unnamed-chunk-62_f10f9e8340fdf1b6c3e1df0f06a2f4ee">
<div class="sourceCode cell-code" id="cb121"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb121-1"><a href="#cb121-1" aria-hidden="true" tabindex="-1"></a>pattern <span class="ot">&lt;-</span> <span class="st">"^</span><span class="sc">\\</span><span class="st">d$"</span></span>
<span id="cb121-2"><a href="#cb121-2" aria-hidden="true" tabindex="-1"></a>yes <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"1"</span>, <span class="st">"5"</span>, <span class="st">"9"</span>)</span>
<span id="cb121-3"><a href="#cb121-3" aria-hidden="true" tabindex="-1"></a>no <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"12"</span>, <span class="st">"123"</span>, <span class="st">" 1"</span>, <span class="st">"a4"</span>, <span class="st">"b"</span>)</span>
<span id="cb121-4"><a href="#cb121-4" aria-hidden="true" tabindex="-1"></a>s <span class="ot">&lt;-</span> <span class="fu">c</span>(yes, no)</span>
<span id="cb121-5"><a href="#cb121-5" aria-hidden="true" tabindex="-1"></a><span class="fu">str_view_all</span>(s, pattern)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] │ &lt;1&gt;
[2] │ &lt;5&gt;
[3] │ &lt;9&gt;
[4] │ 12
[5] │ 123
[6] │  1
[7] │ a4
[8] │ b</code></pre>
</div>
</div>
<p>The <code>1</code> does not match because it does not start with the digit but rather with a space, which is actually not easy to see.</p>
</section>
<section id="quantifiers" class="level4" data-number="13.3.3.4">
<h4 data-number="13.3.3.4" class="anchored" data-anchor-id="quantifiers"><span class="header-section-number">13.3.3.4</span> Quantifiers</h4>
<p>For the inches part, we can have one or two digits. This can be specified in regex with <em>quantifiers</em>. This is done by following the pattern with curly brackets containing the number of times the previous entry can be repeated. We use an example to illustrate. The pattern for one or two digits is:</p>
<div class="cell" data-hash="13-wrangling_cache/html/unnamed-chunk-63_eef8e81941edd858a54fdffc7d925ed5">
<div class="sourceCode cell-code" id="cb123"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb123-1"><a href="#cb123-1" aria-hidden="true" tabindex="-1"></a>pattern <span class="ot">&lt;-</span> <span class="st">"^</span><span class="sc">\\</span><span class="st">d{1,2}$"</span></span>
<span id="cb123-2"><a href="#cb123-2" aria-hidden="true" tabindex="-1"></a>yes <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"1"</span>, <span class="st">"5"</span>, <span class="st">"9"</span>, <span class="st">"12"</span>)</span>
<span id="cb123-3"><a href="#cb123-3" aria-hidden="true" tabindex="-1"></a>no <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"123"</span>, <span class="st">"a4"</span>, <span class="st">"b"</span>)</span>
<span id="cb123-4"><a href="#cb123-4" aria-hidden="true" tabindex="-1"></a><span class="fu">str_view_all</span>(<span class="fu">c</span>(yes, no), pattern)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] │ &lt;1&gt;
[2] │ &lt;5&gt;
[3] │ &lt;9&gt;
[4] │ &lt;12&gt;
[5] │ 123
[6] │ a4
[7] │ b</code></pre>
</div>
</div>
</section>
<section id="white-space-s" class="level4" data-number="13.3.3.5">
<h4 data-number="13.3.3.5" class="anchored" data-anchor-id="white-space-s"><span class="header-section-number">13.3.3.5</span> White space <code>\s</code></h4>
<p>Another problem we have are spaces. For example, our pattern does not match <code>5' 4"</code> because there is a space between <code>'</code> and <code>4</code> which our pattern does not permit. Spaces are characters and R does not ignore them:</p>
<div class="cell" data-hash="13-wrangling_cache/html/unnamed-chunk-64_62e8d34cd21ca5f7d8d59c27d28aa175">
<div class="sourceCode cell-code" id="cb125"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb125-1"><a href="#cb125-1" aria-hidden="true" tabindex="-1"></a><span class="fu">identical</span>(<span class="st">"Hi"</span>, <span class="st">"Hi "</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] FALSE</code></pre>
</div>
</div>
<p>In regex, <code>\s</code> represents white space. To find patterns like <code>5' 4</code>, we can change our pattern to:</p>
<div class="cell" data-hash="13-wrangling_cache/html/unnamed-chunk-65_8aa4095a44141f31800f758387837d7d">
<div class="sourceCode cell-code" id="cb127"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb127-1"><a href="#cb127-1" aria-hidden="true" tabindex="-1"></a>pattern_2 <span class="ot">&lt;-</span> <span class="st">"^[4-7]'</span><span class="sc">\\</span><span class="st">s</span><span class="sc">\\</span><span class="st">d{1,2}</span><span class="sc">\"</span><span class="st">$"</span></span>
<span id="cb127-2"><a href="#cb127-2" aria-hidden="true" tabindex="-1"></a><span class="fu">str_subset</span>(problems, pattern_2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "5' 4\""  "5' 11\"" "5' 7\"" </code></pre>
</div>
</div>
<p>However, this will not match the patterns with no space. So do we need more than one regex pattern? It turns out we can use a quantifier for this as well.</p>
</section>
<section id="quantifiers-1" class="level4" data-number="13.3.3.6">
<h4 data-number="13.3.3.6" class="anchored" data-anchor-id="quantifiers-1"><span class="header-section-number">13.3.3.6</span> Quantifiers: <code>*</code>, <code>?</code>, <code>+</code></h4>
<p>We want the pattern to permit spaces but not require them. Even if there are several spaces, like in this example <code>5'   4</code>, we still want it to match. There is a quantifier for exactly this purpose. In regex, the character <code>*</code> means zero or more instances of the previous character. Here is an example:</p>
<div class="cell" data-hash="13-wrangling_cache/html/unnamed-chunk-66_f0fd712c7c60198a8aca1730440d545b">
<div class="sourceCode cell-code" id="cb129"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb129-1"><a href="#cb129-1" aria-hidden="true" tabindex="-1"></a>yes <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"AB"</span>, <span class="st">"A1B"</span>, <span class="st">"A11B"</span>, <span class="st">"A111B"</span>, <span class="st">"A1111B"</span>)</span>
<span id="cb129-2"><a href="#cb129-2" aria-hidden="true" tabindex="-1"></a>no <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"A2B"</span>, <span class="st">"A21B"</span>)</span>
<span id="cb129-3"><a href="#cb129-3" aria-hidden="true" tabindex="-1"></a><span class="fu">str_detect</span>(yes, <span class="st">"A1*B"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE TRUE TRUE TRUE TRUE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb131"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb131-1"><a href="#cb131-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_detect</span>(no, <span class="st">"A1*B"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] FALSE FALSE</code></pre>
</div>
</div>
<p>The above matches the first string which has zero 1s and all the strings with one or more 1. We can then improve our pattern by adding the <code>*</code> after the space character <code>\s</code>.</p>
<p>There are two other similar quantifiers. For none or once, we can use <code>?</code>, and for one or more, we can use <code>+</code>. You can see how they differ with this example:</p>
<div class="cell" data-hash="13-wrangling_cache/html/unnamed-chunk-67_56f8c547c239c08ae2503158515247ba">
<div class="sourceCode cell-code" id="cb133"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb133-1"><a href="#cb133-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data.frame</span>(<span class="at">string =</span> <span class="fu">c</span>(<span class="st">"AB"</span>, <span class="st">"A1B"</span>, <span class="st">"A11B"</span>, <span class="st">"A111B"</span>, <span class="st">"A1111B"</span>),</span>
<span id="cb133-2"><a href="#cb133-2" aria-hidden="true" tabindex="-1"></a>           <span class="at">none_or_more =</span> <span class="fu">str_detect</span>(yes, <span class="st">"A1*B"</span>),</span>
<span id="cb133-3"><a href="#cb133-3" aria-hidden="true" tabindex="-1"></a>           <span class="at">nore_or_once =</span> <span class="fu">str_detect</span>(yes, <span class="st">"A1?B"</span>),</span>
<span id="cb133-4"><a href="#cb133-4" aria-hidden="true" tabindex="-1"></a>           <span class="at">once_or_more =</span> <span class="fu">str_detect</span>(yes, <span class="st">"A1+B"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  string none_or_more nore_or_once once_or_more
1     AB         TRUE         TRUE        FALSE
2    A1B         TRUE         TRUE         TRUE
3   A11B         TRUE        FALSE         TRUE
4  A111B         TRUE        FALSE         TRUE
5 A1111B         TRUE        FALSE         TRUE</code></pre>
</div>
</div>
<p>We will actually use all three in our reported heights example, but we will see these in a later section.</p>
</section>
<section id="not" class="level4" data-number="13.3.3.7">
<h4 data-number="13.3.3.7" class="anchored" data-anchor-id="not"><span class="header-section-number">13.3.3.7</span> Not</h4>
<p>To specify patterns that we do <strong>not</strong> want to detect, we can use the <code>^</code> symbol but only <strong>inside</strong> square brackets. Remember that outside the square bracket <code>^</code> means the start of the string. So, for example, if we want to detect digits that are preceded by anything except a letter we can do the following:</p>
<div class="cell" data-hash="13-wrangling_cache/html/unnamed-chunk-68_30f16b504bb867bc1819ff197e4c95ce">
<div class="sourceCode cell-code" id="cb135"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb135-1"><a href="#cb135-1" aria-hidden="true" tabindex="-1"></a>pattern <span class="ot">&lt;-</span> <span class="st">"[^a-zA-Z]</span><span class="sc">\\</span><span class="st">d"</span></span>
<span id="cb135-2"><a href="#cb135-2" aria-hidden="true" tabindex="-1"></a>yes <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">".3"</span>, <span class="st">"+2"</span>, <span class="st">"-0"</span>,<span class="st">"*4"</span>)</span>
<span id="cb135-3"><a href="#cb135-3" aria-hidden="true" tabindex="-1"></a>no <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"A3"</span>, <span class="st">"B2"</span>, <span class="st">"C0"</span>, <span class="st">"E4"</span>)</span>
<span id="cb135-4"><a href="#cb135-4" aria-hidden="true" tabindex="-1"></a><span class="fu">str_detect</span>(yes, pattern)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE TRUE TRUE TRUE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb137"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb137-1"><a href="#cb137-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_detect</span>(no, pattern)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] FALSE FALSE FALSE FALSE</code></pre>
</div>
</div>
<p>Another way to generate a pattern that searches for <em>everything except</em> is to use the upper case of the special character. For example <code>\\D</code> means anything other than a digit, <code>\\S</code> means anything except a space, and so on.</p>
</section>
<section id="lookarounds" class="level4" data-number="13.3.3.8">
<h4 data-number="13.3.3.8" class="anchored" data-anchor-id="lookarounds"><span class="header-section-number">13.3.3.8</span> Lookarounds</h4>
<p>Lookarounds provide a way to ask for one or more conditions to be satisfied without moving the search forward or matching it. For example, you might want to check for multiple conditions and if they are matched, then return the pattern or part of the pattern that matched. An example: check if a string satisfies the conditions for a password and if it does return the password. Suppose the conditions are 1) 8-16 word characters, 2) starts with a letter, and 3) has at least one digit.</p>
<p>There are four types of lookarounds: lookahead <code>(?=pattern)</code>, lookbehind <code>(?&lt;=pattern)</code>, negative lookahead <code>(?!pattern)</code>, and negative lookbehind <code>(?&lt;!pattern)</code>. You can concatenate them to check for multiple conditions so for our example we can write it like this:</p>
<div class="cell" data-hash="13-wrangling_cache/html/unnamed-chunk-69_95c38690f22ebfa581d0f1ad663fdb09">
<div class="sourceCode cell-code" id="cb139"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb139-1"><a href="#cb139-1" aria-hidden="true" tabindex="-1"></a>pattern <span class="ot">&lt;-</span> <span class="st">"(?=</span><span class="sc">\\</span><span class="st">w{8,16})(?=^[a-z|A-Z].*)(?=.*</span><span class="sc">\\</span><span class="st">d+.*).*"</span></span>
<span id="cb139-2"><a href="#cb139-2" aria-hidden="true" tabindex="-1"></a>yes <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Ihatepasswords1"</span>, <span class="st">"password1234"</span>)</span>
<span id="cb139-3"><a href="#cb139-3" aria-hidden="true" tabindex="-1"></a>no <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"sh0rt"</span>, <span class="st">"Ihaterpasswords"</span>, <span class="st">"7X%9,N`yrYG92b7"</span>)</span>
<span id="cb139-4"><a href="#cb139-4" aria-hidden="true" tabindex="-1"></a><span class="fu">str_detect</span>(yes, pattern)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE TRUE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb141"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb141-1"><a href="#cb141-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_detect</span>(no, pattern)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] FALSE FALSE FALSE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb143"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb143-1"><a href="#cb143-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_extract</span>(yes, pattern)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Ihatepasswords1" "password1234"   </code></pre>
</div>
</div>
</section>
<section id="sec-groups" class="level4" data-number="13.3.3.9">
<h4 data-number="13.3.3.9" class="anchored" data-anchor-id="sec-groups"><span class="header-section-number">13.3.3.9</span> Groups</h4>
<p><em>Groups</em> are a powerful aspect of regex that permits the extraction of values. Groups are defined using parentheses. They don’t affect the pattern matching per se. Instead, it permits tools to identify specific parts of the pattern so we can extract them.</p>
<p>We want to change heights written like <code>5.6</code> to <code>5'6</code>.</p>
<p>To avoid changing patterns such as <code>70.2</code>, we will require that the first digit be between 4 and 7 <code>[4-7]</code> and that the second be none or more digits <code>\\d*</code>. Let’s start by defining a simple pattern that matches this:</p>
<div class="cell" data-hash="13-wrangling_cache/html/unnamed-chunk-70_837e791cd9b49512898725249bbb8d03">
<div class="sourceCode cell-code" id="cb145"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb145-1"><a href="#cb145-1" aria-hidden="true" tabindex="-1"></a>pattern_without_groups <span class="ot">&lt;-</span> <span class="st">"^[4-7],</span><span class="sc">\\</span><span class="st">d*$"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We want to extract the digits so we can then form the new version using a period. These are our two groups, so we encapsulate them with parentheses:</p>
<div class="cell" data-hash="13-wrangling_cache/html/unnamed-chunk-71_62bf07a99da8e31c649b2e746e18f215">
<div class="sourceCode cell-code" id="cb146"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb146-1"><a href="#cb146-1" aria-hidden="true" tabindex="-1"></a>pattern_with_groups <span class="ot">&lt;-</span>  <span class="st">"^([4-7]),(</span><span class="sc">\\</span><span class="st">d*)$"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We encapsulate the part of the pattern that matches the parts we want to keep for later use. Adding groups does not affect the detection, since it only signals that we want to save what is captured by the groups. Note that both patterns return the same result when using <code>str_detect</code>:</p>
<div class="cell" data-hash="13-wrangling_cache/html/unnamed-chunk-72_c5a39d88fc03d7048859bc1b623e1c65">
<div class="sourceCode cell-code" id="cb147"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb147-1"><a href="#cb147-1" aria-hidden="true" tabindex="-1"></a>yes <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"5,9"</span>, <span class="st">"5,11"</span>, <span class="st">"6,"</span>, <span class="st">"6,1"</span>)</span>
<span id="cb147-2"><a href="#cb147-2" aria-hidden="true" tabindex="-1"></a>no <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"5'9"</span>, <span class="st">","</span>, <span class="st">"2,8"</span>, <span class="st">"6.1.1"</span>)</span>
<span id="cb147-3"><a href="#cb147-3" aria-hidden="true" tabindex="-1"></a>s <span class="ot">&lt;-</span> <span class="fu">c</span>(yes, no)</span>
<span id="cb147-4"><a href="#cb147-4" aria-hidden="true" tabindex="-1"></a><span class="fu">str_detect</span>(s, pattern_without_groups)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1]  TRUE  TRUE  TRUE  TRUE FALSE FALSE FALSE FALSE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb149"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb149-1"><a href="#cb149-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_detect</span>(s, pattern_with_groups)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1]  TRUE  TRUE  TRUE  TRUE FALSE FALSE FALSE FALSE</code></pre>
</div>
</div>
<p>Once we define groups, we can use the function <code>str_match</code> to extract the values these groups define:</p>
<div class="cell" data-hash="13-wrangling_cache/html/unnamed-chunk-73_7eac5784bb5834903af6885e00871ed1">
<div class="sourceCode cell-code" id="cb151"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb151-1"><a href="#cb151-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_match</span>(s, pattern_with_groups)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     [,1]   [,2] [,3]
[1,] "5,9"  "5"  "9" 
[2,] "5,11" "5"  "11"
[3,] "6,"   "6"  ""  
[4,] "6,1"  "6"  "1" 
[5,] NA     NA   NA  
[6,] NA     NA   NA  
[7,] NA     NA   NA  
[8,] NA     NA   NA  </code></pre>
</div>
</div>
<p>Notice that the second and third columns contain feet and inches, respectively. The first column is the part of the string matching the pattern. If no match occurred, we see an <code>NA</code>.</p>
<p>Now we can understand the difference between the functions <code>str_extract</code> and <code>str_match</code>: <code>str_extract</code> extracts only strings that match a pattern, not the values defined by groups:</p>
<div class="cell" data-hash="13-wrangling_cache/html/unnamed-chunk-74_97d4576023751497119f3d6e3fba761a">
<div class="sourceCode cell-code" id="cb153"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb153-1"><a href="#cb153-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_extract</span>(s, pattern_with_groups)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "5,9"  "5,11" "6,"   "6,1"  NA     NA     NA     NA    </code></pre>
</div>
</div>
</section>
</section>
<section id="search-and-replace-with-regex" class="level3" data-number="13.3.4">
<h3 data-number="13.3.4" class="anchored" data-anchor-id="search-and-replace-with-regex"><span class="header-section-number">13.3.4</span> Search and replace with regex</h3>
<p>Earlier we defined the object <code>problems</code> containing the strings that do not appear to be in inches. We can see that not too many of our problematic strings match the pattern:</p>
<div class="cell" data-hash="13-wrangling_cache/html/unnamed-chunk-75_b4264510c4b1c49e429024d4599c92e0">
<div class="sourceCode cell-code" id="cb155"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb155-1"><a href="#cb155-1" aria-hidden="true" tabindex="-1"></a>pattern <span class="ot">&lt;-</span> <span class="st">"^[4-7]'</span><span class="sc">\\</span><span class="st">d{1,2}</span><span class="sc">\"</span><span class="st">$"</span></span>
<span id="cb155-2"><a href="#cb155-2" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(<span class="fu">str_detect</span>(problems, pattern))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 14</code></pre>
</div>
</div>
<p>To see why this is, we show some examples that expose why we don’t have more matches:</p>
<div class="cell" data-hash="13-wrangling_cache/html/unnamed-chunk-76_51c17a0b0597b4e679b668fa05beb99b">
<div class="sourceCode cell-code" id="cb157"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb157-1"><a href="#cb157-1" aria-hidden="true" tabindex="-1"></a>problems[  <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">10</span>, <span class="dv">11</span>, <span class="dv">12</span>, <span class="dv">15</span>)] <span class="sc">|&gt;</span> <span class="fu">str_view_all</span>(pattern)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] │ 5' 4"
[2] │ &lt;5'7"&gt;
[3] │ &lt;5'3"&gt;
[4] │ 5 feet and 8.11 inches
[5] │ 5.5</code></pre>
</div>
</div>
<p>An initial problem we see immediately is that some students wrote out the words “feet” and “inches”. We can see the entries that did this with the <code>str_subset</code> function:</p>
<div class="cell" data-hash="13-wrangling_cache/html/unnamed-chunk-77_35ea443fed4e0a93c5b919ac36f2ceee">
<div class="sourceCode cell-code" id="cb159"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb159-1"><a href="#cb159-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_subset</span>(problems, <span class="st">"inches"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "5 feet and 8.11 inches" "Five foot eight inches" "5 feet 7inches"        
[4] "5ft 9 inches"           "5 ft 9 inches"          "5 feet 6 inches"       </code></pre>
</div>
</div>
<p>We also see that some entries used two single quotes <code>''</code> instead of a double quote <code>"</code>.</p>
<div class="cell" data-hash="13-wrangling_cache/html/unnamed-chunk-78_cbeaf13688a7b3b65f7f07bc79d1adb7">
<div class="sourceCode cell-code" id="cb161"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb161-1"><a href="#cb161-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_subset</span>(problems, <span class="st">"''"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "5'9''"   "5'10''"  "5'10''"  "5'3''"   "5'7''"   "5'6''"   "5'7.5''"
 [8] "5'7.5''" "5'10''"  "5'11''"  "5'10''"  "5'5''"  </code></pre>
</div>
</div>
<p>To correct this, we can replace the different ways of representing inches and feet with a uniform symbol. We will use <code>'</code> for feet, whereas for inches we will simply not use a symbol since some entries were of the form <code>x'y</code>. Now, if we no longer use the inches symbol, we have to change our pattern accordingly:</p>
<div class="cell" data-hash="13-wrangling_cache/html/unnamed-chunk-79_12247eacbc0f6629a16f608628e762dd">
<div class="sourceCode cell-code" id="cb163"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb163-1"><a href="#cb163-1" aria-hidden="true" tabindex="-1"></a>pattern <span class="ot">&lt;-</span> <span class="st">"^[4-7]'</span><span class="sc">\\</span><span class="st">d{1,2}$"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>If we do this replacement before the matching, we get many more matches:</p>
<div class="cell" data-hash="13-wrangling_cache/html/unnamed-chunk-80_c1b1724c535dfb3c97916342391cadc3">
<div class="sourceCode cell-code" id="cb164"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb164-1"><a href="#cb164-1" aria-hidden="true" tabindex="-1"></a>problems <span class="sc">|&gt;</span> </span>
<span id="cb164-2"><a href="#cb164-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">str_replace</span>(<span class="st">"feet|ft|foot"</span>, <span class="st">"'"</span>) <span class="sc">|&gt;</span> <span class="co"># replace feet, ft, foot with ' </span></span>
<span id="cb164-3"><a href="#cb164-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">str_replace</span>(<span class="st">"inches|in|''|</span><span class="sc">\"</span><span class="st">"</span>, <span class="st">""</span>) <span class="sc">|&gt;</span> <span class="co"># remove all inches symbols</span></span>
<span id="cb164-4"><a href="#cb164-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">str_detect</span>(pattern) <span class="sc">|&gt;</span> </span>
<span id="cb164-5"><a href="#cb164-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sum</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 48</code></pre>
</div>
</div>
<p>However, we still have many cases to go.</p>
<p>Note that in the code above, we leveraged the <strong>stringr</strong> consistency and used the pipe.</p>
<p>For now, we improve our pattern by adding <code>\\s*</code> in front of and after the feet symbol <code>'</code> to permit space between the feet symbol and the numbers. Now we match a few more entries:</p>
<div class="cell" data-hash="13-wrangling_cache/html/unnamed-chunk-81_293a207f6801b352b63e9b1e00a52a0d">
<div class="sourceCode cell-code" id="cb166"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb166-1"><a href="#cb166-1" aria-hidden="true" tabindex="-1"></a>pattern <span class="ot">&lt;-</span> <span class="st">"^[4-7]</span><span class="sc">\\</span><span class="st">s*'</span><span class="sc">\\</span><span class="st">s*</span><span class="sc">\\</span><span class="st">d{1,2}$"</span></span>
<span id="cb166-2"><a href="#cb166-2" aria-hidden="true" tabindex="-1"></a>problems <span class="sc">|&gt;</span> </span>
<span id="cb166-3"><a href="#cb166-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">str_replace</span>(<span class="st">"feet|ft|foot"</span>, <span class="st">"'"</span>) <span class="sc">|&gt;</span> <span class="co"># replace feet, ft, foot with ' </span></span>
<span id="cb166-4"><a href="#cb166-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">str_replace</span>(<span class="st">"inches|in|''|</span><span class="sc">\"</span><span class="st">"</span>, <span class="st">""</span>) <span class="sc">|&gt;</span> <span class="co"># remove all inches symbols</span></span>
<span id="cb166-5"><a href="#cb166-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">str_detect</span>(pattern) <span class="sc">|&gt;</span> </span>
<span id="cb166-6"><a href="#cb166-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sum</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 53</code></pre>
</div>
</div>
<section id="search-and-replace-using-groups" class="level4" data-number="13.3.4.1">
<h4 data-number="13.3.4.1" class="anchored" data-anchor-id="search-and-replace-using-groups"><span class="header-section-number">13.3.4.1</span> Search and replace using groups</h4>
<p>Another powerful aspect of groups is that you can refer to the extracted values in a regex when searching and replacing.</p>
<p>The regex special character for the <code>i</code>-th group is <code>\\i</code>. So <code>\\1</code> is the value extracted from the first group, <code>\\2</code> the value from the second and so on. As a simple example, note that the following code will replace a comma with period, but only if it is between two digits:</p>
<div class="cell" data-hash="13-wrangling_cache/html/unnamed-chunk-82_66c77025a070c24741cefa1b80974f4b">
<div class="sourceCode cell-code" id="cb168"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb168-1"><a href="#cb168-1" aria-hidden="true" tabindex="-1"></a>pattern_with_groups <span class="ot">&lt;-</span>  <span class="st">"^([4-7]),(</span><span class="sc">\\</span><span class="st">d*)$"</span></span>
<span id="cb168-2"><a href="#cb168-2" aria-hidden="true" tabindex="-1"></a>yes <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"5,9"</span>, <span class="st">"5,11"</span>, <span class="st">"6,"</span>, <span class="st">"6,1"</span>)</span>
<span id="cb168-3"><a href="#cb168-3" aria-hidden="true" tabindex="-1"></a>no <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"5'9"</span>, <span class="st">","</span>, <span class="st">"2,8"</span>, <span class="st">"6.1.1"</span>)</span>
<span id="cb168-4"><a href="#cb168-4" aria-hidden="true" tabindex="-1"></a>s <span class="ot">&lt;-</span> <span class="fu">c</span>(yes, no)</span>
<span id="cb168-5"><a href="#cb168-5" aria-hidden="true" tabindex="-1"></a><span class="fu">str_replace</span>(s, pattern_with_groups, <span class="st">"</span><span class="sc">\\</span><span class="st">1'</span><span class="sc">\\</span><span class="st">2"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "5'9"   "5'11"  "6'"    "6'1"   "5'9"   ","     "2,8"   "6.1.1"</code></pre>
</div>
</div>
</section>
</section>
<section id="trimming" class="level3" data-number="13.3.5">
<h3 data-number="13.3.5" class="anchored" data-anchor-id="trimming"><span class="header-section-number">13.3.5</span> Trimming</h3>
<p>In general, spaces at the start or end of the string are uninformative. These can be particularly deceptive because sometimes they can be hard to see:</p>
<div class="cell" data-hash="13-wrangling_cache/html/unnamed-chunk-83_beabd6cc2ac2312be3ec502293de13b7">
<div class="sourceCode cell-code" id="cb170"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb170-1"><a href="#cb170-1" aria-hidden="true" tabindex="-1"></a>s <span class="ot">&lt;-</span> <span class="st">"Hi "</span></span>
<span id="cb170-2"><a href="#cb170-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(s)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Hi </code></pre>
</div>
<div class="sourceCode cell-code" id="cb172"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb172-1"><a href="#cb172-1" aria-hidden="true" tabindex="-1"></a><span class="fu">identical</span>(s, <span class="st">"Hi"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] FALSE</code></pre>
</div>
</div>
<p>This is a general enough problem that there is a function dedicated to removing them: <code>str_trim</code>.</p>
<div class="cell" data-hash="13-wrangling_cache/html/unnamed-chunk-84_6577962d29570be9b5b2d6cdf1128df1">
<div class="sourceCode cell-code" id="cb174"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb174-1"><a href="#cb174-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_trim</span>(<span class="st">" 5 ' 9 "</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "5 ' 9"</code></pre>
</div>
</div>
</section>
<section id="changing-lettercase" class="level3" data-number="13.3.6">
<h3 data-number="13.3.6" class="anchored" data-anchor-id="changing-lettercase"><span class="header-section-number">13.3.6</span> Changing lettercase</h3>
<div class="cell" data-hash="13-wrangling_cache/html/unnamed-chunk-85_572a56edd7bd49fc9b81dd75cde4e009">
<div class="sourceCode cell-code" id="cb176"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb176-1"><a href="#cb176-1" aria-hidden="true" tabindex="-1"></a>s <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Five feet eight inches"</span>)</span>
<span id="cb176-2"><a href="#cb176-2" aria-hidden="true" tabindex="-1"></a><span class="fu">str_to_lower</span>(s)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "five feet eight inches"</code></pre>
</div>
</div>
<p>Other related functions are <code>str_to_upper</code> and <code>str_to_title</code>. We are now ready to define a procedure that converts all the problematic cases to inches.</p>
</section>
<section id="the-extract-function" class="level3" data-number="13.3.7">
<h3 data-number="13.3.7" class="anchored" data-anchor-id="the-extract-function"><span class="header-section-number">13.3.7</span> The <code>extract</code> function</h3>
<p>The <code>extract</code> function is a useful <strong>tidyverse</strong> function for string processing that we will use in our final solution, so we introduce it here. In a previous section, we constructed a regex that lets us identify which elements of a character vector match the feet and inches pattern. However, we want to do more. We want to extract and save the feet and number values so that we can convert them to inches when appropriate.</p>
<p>If we have a simpler case like this:</p>
<div class="cell" data-hash="13-wrangling_cache/html/unnamed-chunk-86_a42c7a38f36b7dc279b03381cae27080">
<div class="sourceCode cell-code" id="cb178"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb178-1"><a href="#cb178-1" aria-hidden="true" tabindex="-1"></a>s <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"5'10"</span>, <span class="st">"6'1"</span>)</span>
<span id="cb178-2"><a href="#cb178-2" aria-hidden="true" tabindex="-1"></a>tab <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">x =</span> s)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>In Section <a href="#sec-separate"><span>Section&nbsp;13.1.3</span></a> we learned about the <code>separate</code> function, which can be used to achieve our current goal:</p>
<div class="cell" data-hash="13-wrangling_cache/html/unnamed-chunk-87_793f20134eceeba6d36a2ac0bd5d9ddf">
<div class="sourceCode cell-code" id="cb179"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb179-1"><a href="#cb179-1" aria-hidden="true" tabindex="-1"></a>tab <span class="sc">|&gt;</span> <span class="fu">separate</span>(x, <span class="fu">c</span>(<span class="st">"feet"</span>, <span class="st">"inches"</span>), <span class="at">sep =</span> <span class="st">"'"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  feet inches
1    5     10
2    6      1</code></pre>
</div>
</div>
<p>The <code>extract</code> function from the <strong>tidyr</strong> package lets us use regex groups to extract the desired values. Here is the equivalent to the code above using <code>separate</code> but using <code>extract</code>:</p>
<div class="cell" data-hash="13-wrangling_cache/html/unnamed-chunk-88_c496cc01f4a817d2640ee7638a00e76a">
<div class="sourceCode cell-code" id="cb181"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb181-1"><a href="#cb181-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb181-2"><a href="#cb181-2" aria-hidden="true" tabindex="-1"></a>tab <span class="sc">|&gt;</span> <span class="fu">extract</span>(x, <span class="fu">c</span>(<span class="st">"feet"</span>, <span class="st">"inches"</span>), <span class="at">regex =</span> <span class="st">"(</span><span class="sc">\\</span><span class="st">d)'(</span><span class="sc">\\</span><span class="st">d{1,2})"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  feet inches
1    5     10
2    6      1</code></pre>
</div>
</div>
<p>So why do we even need the new function <code>extract</code>? We have seen how small changes can throw off exact pattern matching. Groups in regex give us more flexibility. For example, if we define:</p>
<div class="cell" data-hash="13-wrangling_cache/html/unnamed-chunk-89_83cf21da23d455ba7dea8dfbf6ad20bb">
<div class="sourceCode cell-code" id="cb183"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb183-1"><a href="#cb183-1" aria-hidden="true" tabindex="-1"></a>s <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"5'10"</span>, <span class="st">"6'1</span><span class="sc">\"</span><span class="st">"</span>,<span class="st">"5'8inches"</span>)</span>
<span id="cb183-2"><a href="#cb183-2" aria-hidden="true" tabindex="-1"></a>tab <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">x =</span> s)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>and we only want the numbers, <code>separate</code> fails:</p>
<div class="cell" data-hash="13-wrangling_cache/html/unnamed-chunk-90_34050b7a74b6d7fd0fa248a473fee706">
<div class="sourceCode cell-code" id="cb184"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb184-1"><a href="#cb184-1" aria-hidden="true" tabindex="-1"></a>tab <span class="sc">|&gt;</span> <span class="fu">separate</span>(x, <span class="fu">c</span>(<span class="st">"feet"</span>,<span class="st">"inches"</span>), <span class="at">sep =</span> <span class="st">"'"</span>, <span class="at">fill =</span> <span class="st">"right"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  feet  inches
1    5      10
2    6      1"
3    5 8inches</code></pre>
</div>
</div>
<p>However, we can use <code>extract</code>. The regex here is a bit more complicated since we have to permit <code>'</code> with spaces and <code>feet</code>. We also do not want the <code>"</code> included in the value, so we do not include that in the group:</p>
<div class="cell" data-hash="13-wrangling_cache/html/unnamed-chunk-91_82e23a01750ae84744f1cded27b1db14">
<div class="sourceCode cell-code" id="cb186"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb186-1"><a href="#cb186-1" aria-hidden="true" tabindex="-1"></a>tab <span class="sc">|&gt;</span> <span class="fu">extract</span>(x, <span class="fu">c</span>(<span class="st">"feet"</span>, <span class="st">"inches"</span>), <span class="at">regex =</span> <span class="st">"(</span><span class="sc">\\</span><span class="st">d)'(</span><span class="sc">\\</span><span class="st">d{1,2})"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  feet inches
1    5     10
2    6      1
3    5      8</code></pre>
</div>
</div>
</section>
<section id="putting-it-all-together" class="level3" data-number="13.3.8">
<h3 data-number="13.3.8" class="anchored" data-anchor-id="putting-it-all-together"><span class="header-section-number">13.3.8</span> Putting it all together</h3>
<p>We are now ready to put it all together and wrangle our reported heights data to try to recover as many heights as possible. The code is complex, but we will break it down into parts.</p>
<p>We start by cleaning up the <code>height</code> column so that the heights are closer to a feet’inches format. We added an original heights column so we can compare before and after.</p>
<p>We now put all of what we have learned together into a function that takes a string vector and tries to convert as many strings as possible to one format. We write a function that puts together what we have done above.</p>
<div class="cell" data-hash="13-wrangling_cache/html/unnamed-chunk-92_a8da6e78babe560525efba986af859b8">
<div class="sourceCode cell-code" id="cb188"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb188-1"><a href="#cb188-1" aria-hidden="true" tabindex="-1"></a>convert_format <span class="ot">&lt;-</span> <span class="cf">function</span>(s){</span>
<span id="cb188-2"><a href="#cb188-2" aria-hidden="true" tabindex="-1"></a>  s <span class="sc">|&gt;</span></span>
<span id="cb188-3"><a href="#cb188-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_replace</span>(<span class="st">"feet|foot|ft"</span>, <span class="st">"'"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb188-4"><a href="#cb188-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_replace_all</span>(<span class="st">"inches|in|''|</span><span class="sc">\"</span><span class="st">|cm|and"</span>, <span class="st">""</span>) <span class="sc">|&gt;</span>  </span>
<span id="cb188-5"><a href="#cb188-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_replace</span>(<span class="st">"^([4-7])</span><span class="sc">\\</span><span class="st">s*[,</span><span class="sc">\\</span><span class="st">.</span><span class="sc">\\</span><span class="st">s+]</span><span class="sc">\\</span><span class="st">s*(</span><span class="sc">\\</span><span class="st">d*)$"</span>, <span class="st">"</span><span class="sc">\\</span><span class="st">1'</span><span class="sc">\\</span><span class="st">2"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb188-6"><a href="#cb188-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_replace</span>(<span class="st">"^([56])'?$"</span>, <span class="st">"</span><span class="sc">\\</span><span class="st">1'0"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb188-7"><a href="#cb188-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_replace</span>(<span class="st">"^([12])</span><span class="sc">\\</span><span class="st">s*,</span><span class="sc">\\</span><span class="st">s*(</span><span class="sc">\\</span><span class="st">d*)$"</span>, <span class="st">"</span><span class="sc">\\</span><span class="st">1</span><span class="sc">\\</span><span class="st">.</span><span class="sc">\\</span><span class="st">2"</span>) <span class="sc">|&gt;</span>  </span>
<span id="cb188-8"><a href="#cb188-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_trim</span>() </span>
<span id="cb188-9"><a href="#cb188-9" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb188-10"><a href="#cb188-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(english)</span>
<span id="cb188-11"><a href="#cb188-11" aria-hidden="true" tabindex="-1"></a>words_to_numbers <span class="ot">&lt;-</span> <span class="cf">function</span>(s){</span>
<span id="cb188-12"><a href="#cb188-12" aria-hidden="true" tabindex="-1"></a>  s <span class="ot">&lt;-</span> <span class="fu">str_to_lower</span>(s)</span>
<span id="cb188-13"><a href="#cb188-13" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">11</span>)</span>
<span id="cb188-14"><a href="#cb188-14" aria-hidden="true" tabindex="-1"></a>    s <span class="ot">&lt;-</span> <span class="fu">str_replace_all</span>(s, <span class="fu">words</span>(i), <span class="fu">as.character</span>(i))</span>
<span id="cb188-15"><a href="#cb188-15" aria-hidden="true" tabindex="-1"></a>  s</span>
<span id="cb188-16"><a href="#cb188-16" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-hash="13-wrangling_cache/html/unnamed-chunk-93_06c4a383c3b2218fea3f88a943c8735d">
<div class="sourceCode cell-code" id="cb189"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb189-1"><a href="#cb189-1" aria-hidden="true" tabindex="-1"></a>pattern <span class="ot">&lt;-</span> <span class="st">"^([4-7])</span><span class="sc">\\</span><span class="st">s*'</span><span class="sc">\\</span><span class="st">s*(</span><span class="sc">\\</span><span class="st">d+</span><span class="sc">\\</span><span class="st">.?</span><span class="sc">\\</span><span class="st">d*)$"</span></span>
<span id="cb189-2"><a href="#cb189-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb189-3"><a href="#cb189-3" aria-hidden="true" tabindex="-1"></a>smallest <span class="ot">&lt;-</span> <span class="dv">50</span></span>
<span id="cb189-4"><a href="#cb189-4" aria-hidden="true" tabindex="-1"></a>tallest <span class="ot">&lt;-</span> <span class="dv">84</span></span>
<span id="cb189-5"><a href="#cb189-5" aria-hidden="true" tabindex="-1"></a>new_heights <span class="ot">&lt;-</span> reported_heights <span class="sc">|&gt;</span> </span>
<span id="cb189-6"><a href="#cb189-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">original =</span> height, </span>
<span id="cb189-7"><a href="#cb189-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">height =</span> <span class="fu">words_to_numbers</span>(height) <span class="sc">|&gt;</span> <span class="fu">convert_format</span>()) <span class="sc">|&gt;</span></span>
<span id="cb189-8"><a href="#cb189-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">extract</span>(height, <span class="fu">c</span>(<span class="st">"feet"</span>, <span class="st">"inches"</span>), <span class="at">regex =</span> pattern, <span class="at">remove =</span> <span class="cn">FALSE</span>) <span class="sc">|&gt;</span> </span>
<span id="cb189-9"><a href="#cb189-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_at</span>(<span class="fu">c</span>(<span class="st">"height"</span>, <span class="st">"feet"</span>, <span class="st">"inches"</span>), as.numeric) <span class="sc">|&gt;</span></span>
<span id="cb189-10"><a href="#cb189-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">guess =</span> <span class="dv">12</span> <span class="sc">*</span> feet <span class="sc">+</span> inches) <span class="sc">|&gt;</span></span>
<span id="cb189-11"><a href="#cb189-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">height =</span> <span class="fu">case_when</span>(</span>
<span id="cb189-12"><a href="#cb189-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">is.na</span>(height) <span class="sc">~</span> <span class="fu">as.numeric</span>(<span class="cn">NA</span>),</span>
<span id="cb189-13"><a href="#cb189-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">between</span>(height, smallest, tallest) <span class="sc">~</span> height,  <span class="co">#inches</span></span>
<span id="cb189-14"><a href="#cb189-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">between</span>(height<span class="sc">/</span><span class="fl">2.54</span>, smallest, tallest) <span class="sc">~</span> height<span class="sc">/</span><span class="fl">2.54</span>, <span class="co">#cm</span></span>
<span id="cb189-15"><a href="#cb189-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">between</span>(height<span class="sc">*</span><span class="dv">100</span><span class="sc">/</span><span class="fl">2.54</span>, smallest, tallest) <span class="sc">~</span> height<span class="sc">*</span><span class="dv">100</span><span class="sc">/</span><span class="fl">2.54</span>, <span class="co">#meters</span></span>
<span id="cb189-16"><a href="#cb189-16" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> <span class="fu">as.numeric</span>(<span class="cn">NA</span>))) <span class="sc">|&gt;</span></span>
<span id="cb189-17"><a href="#cb189-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">height =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(height) <span class="sc">&amp;</span> </span>
<span id="cb189-18"><a href="#cb189-18" aria-hidden="true" tabindex="-1"></a>                           inches <span class="sc">&lt;</span> <span class="dv">12</span> <span class="sc">&amp;</span> <span class="fu">between</span>(guess, smallest, tallest),</span>
<span id="cb189-19"><a href="#cb189-19" aria-hidden="true" tabindex="-1"></a>                         guess, height)) <span class="sc">|&gt;</span></span>
<span id="cb189-20"><a href="#cb189-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>guess)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We can check all the entries we converted by typing:</p>
<div class="cell" data-hash="13-wrangling_cache/html/unnamed-chunk-94_3bf936f6e7b9da6c47535f81896eab5e">
<div class="sourceCode cell-code" id="cb190"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb190-1"><a href="#cb190-1" aria-hidden="true" tabindex="-1"></a>new_heights <span class="sc">|&gt;</span></span>
<span id="cb190-2"><a href="#cb190-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">not_inches</span>(original)) <span class="sc">|&gt;</span></span>
<span id="cb190-3"><a href="#cb190-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(original, height) <span class="sc">|&gt;</span> </span>
<span id="cb190-4"><a href="#cb190-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(height) <span class="sc">|&gt;</span></span>
<span id="cb190-5"><a href="#cb190-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">View</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>A final observation is that if we look at the shortest students in our course:</p>
<div class="cell" data-hash="13-wrangling_cache/html/unnamed-chunk-95_b0a077b5dedfdeb6c51fc594f896f9cc">
<div class="sourceCode cell-code" id="cb191"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb191-1"><a href="#cb191-1" aria-hidden="true" tabindex="-1"></a>new_heights <span class="sc">|&gt;</span> <span class="fu">arrange</span>(height) <span class="sc">|&gt;</span> <span class="fu">head</span>(<span class="at">n =</span> <span class="dv">7</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>           time_stamp    sex height feet inches original
1 2017-07-04 01:30:25   Male  50.00   NA     NA       50
2 2017-09-07 10:40:35   Male  50.00   NA     NA       50
3 2014-09-02 15:18:30 Female  51.00   NA     NA       51
4 2016-06-05 14:07:20 Female  52.00   NA     NA       52
5 2016-06-05 14:07:38 Female  52.00   NA     NA       52
6 2014-09-23 03:39:56 Female  53.00   NA     NA       53
7 2015-01-07 08:57:29   Male  53.77   NA     NA    53.77</code></pre>
</div>
</div>
<p>We see heights of 53, 54, and 55. In the originals, we also have 51 and 52. These short heights are rare and it is likely that the students actually meant <code>5'1</code>, <code>5'2</code>, <code>5'3</code>, <code>5'4</code>, and <code>5'5</code>. Because we are not completely sure, we will leave them as reported. The object <code>new_heights</code> contains our final solution for this case study.</p>
</section>
<section id="string-splitting" class="level3" data-number="13.3.9">
<h3 data-number="13.3.9" class="anchored" data-anchor-id="string-splitting"><span class="header-section-number">13.3.9</span> String splitting</h3>
<p>Another very common data wrangling operation is string splitting. To illustrate how this comes up, we start with an illustrative example. Suppose we did not have the function <code>read_csv</code> or <code>read.csv</code> available to us. We instead have to read a csv file using the base R function <code>readLines</code> like this:</p>
<div class="cell" data-hash="13-wrangling_cache/html/unnamed-chunk-96_12d0477eefc52eb3a6cedb416ff51296">
<div class="sourceCode cell-code" id="cb193"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb193-1"><a href="#cb193-1" aria-hidden="true" tabindex="-1"></a>filename <span class="ot">&lt;-</span> <span class="fu">system.file</span>(<span class="st">"extdata/murders.csv"</span>, <span class="at">package =</span> <span class="st">"dslabs"</span>)</span>
<span id="cb193-2"><a href="#cb193-2" aria-hidden="true" tabindex="-1"></a>lines <span class="ot">&lt;-</span> <span class="fu">readLines</span>(filename)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This function reads-in the data line-by-line to create a vector of strings. In this case, one string for each row in the spreadsheet. The first six lines are:</p>
<div class="cell" data-hash="13-wrangling_cache/html/unnamed-chunk-97_c66fa91a1de0c91f05cdcae60b3b8b0a">
<div class="sourceCode cell-code" id="cb194"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb194-1"><a href="#cb194-1" aria-hidden="true" tabindex="-1"></a>lines <span class="sc">|&gt;</span> <span class="fu">head</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "state,abb,region,population,total" "Alabama,AL,South,4779736,135"     
[3] "Alaska,AK,West,710231,19"          "Arizona,AZ,West,6392017,232"      
[5] "Arkansas,AR,South,2915918,93"      "California,CA,West,37253956,1257" </code></pre>
</div>
</div>
<p>We want to extract the values that are separated by a comma for each string in the vector. The command <code>str_split</code> does exactly this:</p>
<div class="cell" data-hash="13-wrangling_cache/html/unnamed-chunk-98_5b3e51b9cd49b7409de8689444a75f97">
<div class="sourceCode cell-code" id="cb196"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb196-1"><a href="#cb196-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">str_split</span>(lines, <span class="st">","</span>) </span>
<span id="cb196-2"><a href="#cb196-2" aria-hidden="true" tabindex="-1"></a>x <span class="sc">|&gt;</span> <span class="fu">head</span>(<span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[[1]]
[1] "state"      "abb"        "region"     "population" "total"     

[[2]]
[1] "Alabama" "AL"      "South"   "4779736" "135"    </code></pre>
</div>
</div>
</section>
<section id="sec-recode" class="level3" data-number="13.3.10">
<h3 data-number="13.3.10" class="anchored" data-anchor-id="sec-recode"><span class="header-section-number">13.3.10</span> Recoding</h3>
<p>Another common operation involving strings is recoding the names of categorical variables. Let’s say you have really long names for your levels and you will be displaying them in plots, you might want to use shorter versions of these names. For example, in character vectors with country names, you might want to change “United States of America” to “USA” and “United Kingdom” to UK, and so on. We can do this with <code>case_when</code>, although the <strong>tidyverse</strong> offers an option that is specifically designed for this task: the <code>case_match</code> function.</p>
<p>Here is an example that shows how to rename countries with long names:</p>
<div class="cell" data-hash="13-wrangling_cache/html/unnamed-chunk-99_508f5d7200ca26f23c1b38e401b41bb4">
<div class="sourceCode cell-code" id="cb198"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb198-1"><a href="#cb198-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dslabs)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Suppose we want to show life expectancy time series by country for the Caribbean:</p>
<div class="cell" data-hash="13-wrangling_cache/html/caribbean_c8d1ef40efa085f97410df63e7f9437a">
<div class="sourceCode cell-code" id="cb199"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb199-1"><a href="#cb199-1" aria-hidden="true" tabindex="-1"></a>gapminder <span class="sc">|&gt;</span> </span>
<span id="cb199-2"><a href="#cb199-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(region <span class="sc">==</span> <span class="st">"Caribbean"</span>) <span class="sc">|&gt;</span></span>
<span id="cb199-3"><a href="#cb199-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(year, life_expectancy, <span class="at">color =</span> country)) <span class="sc">+</span></span>
<span id="cb199-4"><a href="#cb199-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="13-wrangling_files/figure-html/caribbean-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell" data-hash="13-wrangling_cache/html/caribbean-with-nicknames_412881e9b314b795d62e358019410c1c">
<div class="sourceCode cell-code" id="cb200"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb200-1"><a href="#cb200-1" aria-hidden="true" tabindex="-1"></a>gapminder <span class="sc">|&gt;</span> <span class="fu">filter</span>(region <span class="sc">==</span> <span class="st">"Caribbean"</span>) <span class="sc">|&gt;</span></span>
<span id="cb200-2"><a href="#cb200-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">country =</span> <span class="fu">case_match</span>(country, </span>
<span id="cb200-3"><a href="#cb200-3" aria-hidden="true" tabindex="-1"></a>                          <span class="st">"Antigua and Barbuda"</span> <span class="sc">~</span> <span class="st">"Barbuda"</span>,</span>
<span id="cb200-4"><a href="#cb200-4" aria-hidden="true" tabindex="-1"></a>                          <span class="st">"Dominican Republic"</span> <span class="sc">~</span> <span class="st">"DR"</span>,</span>
<span id="cb200-5"><a href="#cb200-5" aria-hidden="true" tabindex="-1"></a>                          <span class="st">"St. Vincent and the Grenadines"</span> <span class="sc">~</span> <span class="st">"St. Vincent"</span>,</span>
<span id="cb200-6"><a href="#cb200-6" aria-hidden="true" tabindex="-1"></a>                          <span class="st">"Trinidad and Tobago"</span> <span class="sc">~</span> <span class="st">"Trinidad"</span>,</span>
<span id="cb200-7"><a href="#cb200-7" aria-hidden="true" tabindex="-1"></a>                          <span class="at">.default =</span> country)) <span class="sc">|&gt;</span></span>
<span id="cb200-8"><a href="#cb200-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(year, life_expectancy, <span class="at">color =</span> country)) <span class="sc">+</span></span>
<span id="cb200-9"><a href="#cb200-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="13-wrangling_files/figure-html/caribbean-with-nicknames-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>There are other similar functions in other R packages, such as <code>recode_factor</code> and <code>fct_recoder</code> in the <strong>forcats</strong> package.</p>
</section>
</section>
<section id="exercises" class="level2" data-number="13.4">
<h2 data-number="13.4" class="anchored" data-anchor-id="exercises"><span class="header-section-number">13.4</span> Exercises</h2>
<ol class="example" type="1">
<li>Run the following command to define the <code>co2_wide</code> object:</li>
</ol>
<div class="cell" data-hash="13-wrangling_cache/html/unnamed-chunk-100_d29fa26973e540dcc3aac145427f3e8d">
<div class="sourceCode cell-code" id="cb201"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb201-1"><a href="#cb201-1" aria-hidden="true" tabindex="-1"></a>co2_wide <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">matrix</span>(co2, <span class="at">ncol =</span> <span class="dv">12</span>, <span class="at">byrow =</span> <span class="cn">TRUE</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb201-2"><a href="#cb201-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">setNames</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">12</span>) <span class="sc">|&gt;</span></span>
<span id="cb201-3"><a href="#cb201-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">year =</span> <span class="fu">as.character</span>(<span class="dv">1959</span><span class="sc">:</span><span class="dv">1997</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Use the <code>pivot_longer</code> function to wrangle this into a tidy dataset. Call the column with the CO2 measurements <code>co2</code> and call the month column <code>month</code>. Call the resulting object <code>co2_tidy</code>.</p>
<ol start="2" class="example" type="1">
<li>Plot CO2 versus month with a different curve for each year using this code:</li>
</ol>
<div class="cell" data-hash="13-wrangling_cache/html/unnamed-chunk-101_cb10f9cebfce9f262b0ecb81fc63acb2">
<div class="sourceCode cell-code" id="cb202"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb202-1"><a href="#cb202-1" aria-hidden="true" tabindex="-1"></a>co2_tidy <span class="sc">|&gt;</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(month, co2, <span class="at">color =</span> year)) <span class="sc">+</span> <span class="fu">geom_line</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>If the expected plot is not made, it is probably because <code>co2_tidy$month</code> is not numeric:</p>
<div class="cell" data-hash="13-wrangling_cache/html/unnamed-chunk-102_c4e0ae5252d9f9a06c44533d5f9a3b99">
<div class="sourceCode cell-code" id="cb203"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb203-1"><a href="#cb203-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(co2_tidy<span class="sc">$</span>month)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Rewrite your code to make sure the month column is numeric. Then make the plot.</p>
<ol start="3" class="example" type="1">
<li>What do we learn from this plot?</li>
</ol>
<ol type="a">
<li>CO2 measures increase monotonically from 1959 to 1997.</li>
<li>CO2 measures are higher in the summer and the yearly average increased from 1959 to 1997.</li>
<li>CO2 measures appear constant and random variability explains the differences.</li>
<li>CO2 measures do not have a seasonal trend.</li>
</ol>
<ol start="4" class="example" type="1">
<li>Now load the <code>admissions</code> data set, which contains admission information for men and women across six majors and keep only the admitted percentage column:</li>
</ol>
<div class="cell" data-hash="13-wrangling_cache/html/unnamed-chunk-103_61d6a0e521e18b6f2060b5baac653426">
<div class="sourceCode cell-code" id="cb204"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb204-1"><a href="#cb204-1" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(admissions)</span>
<span id="cb204-2"><a href="#cb204-2" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> admissions <span class="sc">|&gt;</span> <span class="fu">select</span>(<span class="sc">-</span>applicants)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>If we think of an observation as a major, and that each observation has two variables (men admitted percentage and women admitted percentage) then this is not tidy. Use the <code>pivot_wider</code> function to wrangle into tidy shape: one row for each major.</p>
<ol start="5" class="example" type="1">
<li>Now we will try a more advanced wrangling challenge. We want to wrangle the admissions data so that for each major we have 4 observations: <code>admitted_men</code>, <code>admitted_women</code>, <code>applicants_men</code> and <code>applicants_women</code>. The <em>trick</em> we perform here is actually quite common: first use <code>pivot_longer</code> to generate an intermediate data frame and then <code>pivot_wider</code> to obtain the tidy data we want. We will go step by step in this and the next two exercises.</li>
</ol>
<p>Use the <code>pivot_longer</code> function to create a <code>tmp</code> data.frame with a column containing the type of observation <code>admitted</code> or <code>applicants</code>. Call the new columns <code>name</code> and <code>value</code>.</p>
<ol start="6" class="example" type="1">
<li><p>Now you have an object <code>tmp</code> with columns <code>major</code>, <code>gender</code>, <code>name</code> and <code>value</code>. Note that if you combine the <code>name</code> and <code>gender</code>, we get the column names we want: <code>admitted_men</code>, <code>admitted_women</code>, <code>applicants_men</code> and <code>applicants_women</code>. Use the function <code>unite</code> to create a new column called <code>column_name</code>.</p></li>
<li><p>Now use the <code>pivot_wider</code> function to generate the tidy data with four variables for each major.</p></li>
<li><p>Now use the pipe to write a line of code that turns <code>admissions</code> to the table produced in the previous exercise.</p></li>
<li><p>Install and load the <strong>Lahman</strong> library. This database includes data related to baseball teams. It includes summary statistics about how the players performed on offense and defense for several years. It also includes personal information about the players.</p></li>
</ol>
<p>The <code>Batting</code> data frame contains the offensive statistics for all players for many years. You can see, for example, the top 10 hitters by running this code:</p>
<div class="cell" data-hash="13-wrangling_cache/html/unnamed-chunk-104_6b48c742371f7a9670dfdfff11e79640">
<div class="sourceCode cell-code" id="cb205"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb205-1"><a href="#cb205-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(Lahman)</span>
<span id="cb205-2"><a href="#cb205-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-3"><a href="#cb205-3" aria-hidden="true" tabindex="-1"></a>top <span class="ot">&lt;-</span> Batting <span class="sc">|&gt;</span> </span>
<span id="cb205-4"><a href="#cb205-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(yearID <span class="sc">==</span> <span class="dv">2016</span>) <span class="sc">|&gt;</span></span>
<span id="cb205-5"><a href="#cb205-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(HR)) <span class="sc">|&gt;</span></span>
<span id="cb205-6"><a href="#cb205-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>)</span>
<span id="cb205-7"><a href="#cb205-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-8"><a href="#cb205-8" aria-hidden="true" tabindex="-1"></a>top <span class="sc">|&gt;</span> <span class="fu">as_tibble</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>But who are these players? We see an ID, but not the names. The player names are in this table</p>
<div class="cell" data-hash="13-wrangling_cache/html/unnamed-chunk-105_941fc758f86c3b49495e5f8bd8498b8a">
<div class="sourceCode cell-code" id="cb206"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb206-1"><a href="#cb206-1" aria-hidden="true" tabindex="-1"></a>People <span class="sc">|&gt;</span> <span class="fu">as_tibble</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We can see column names <code>nameFirst</code> and <code>nameLast</code>. Use the <code>left_join</code> function to create a table of the top home run hitters. The table should have <code>playerID</code>, first name, last name, and number of home runs (HR). Rewrite the object <code>top</code> with this new table.</p>
<ol start="10" class="example" type="1">
<li><p>Now use the <code>Salaries</code> data frame to add each player’s salary to the table you created in exercise 1. Note that salaries are different every year so make sure to filter for the year 2016, then use <code>right_join</code>. This time show first name, last name, team, HR, and salary.</p></li>
<li><p>In a previous exercise, we created a tidy version of the <code>co2</code> dataset:</p></li>
</ol>
<div class="cell" data-hash="13-wrangling_cache/html/unnamed-chunk-106_6a7a5817cc24bf14b0a1f5b249b3b70c">
<div class="sourceCode cell-code" id="cb207"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb207-1"><a href="#cb207-1" aria-hidden="true" tabindex="-1"></a>co2_wide <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">matrix</span>(co2, <span class="at">ncol =</span> <span class="dv">12</span>, <span class="at">byrow =</span> <span class="cn">TRUE</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb207-2"><a href="#cb207-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">setNames</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">12</span>) <span class="sc">|&gt;</span></span>
<span id="cb207-3"><a href="#cb207-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">year =</span> <span class="dv">1959</span><span class="sc">:</span><span class="dv">1997</span>) <span class="sc">|&gt;</span></span>
<span id="cb207-4"><a href="#cb207-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span>year, <span class="at">names_to =</span> <span class="st">"month"</span>, <span class="at">values_to =</span> <span class="st">"co2"</span>) <span class="sc">|&gt;</span></span>
<span id="cb207-5"><a href="#cb207-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">month =</span> <span class="fu">as.numeric</span>(month))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We want to see if the monthly trend is changing so we are going to remove the year effects and then plot the results. We will first compute the year averages. Use the <code>group_by</code> and <code>summarize</code> to compute the average co2 for each year. Save in an object called <code>yearly_avg</code>.</p>
<ol start="12" class="example" type="1">
<li><p>Now use the <code>left_join</code> function to add the yearly average to the <code>co2_wide</code> dataset. Then compute the residuals: observed co2 measure - yearly average.</p></li>
<li><p>Make a plot of the seasonal trends by year but only after removing the year effect.</p></li>
</ol>


</section>
<section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes">
<hr>
<ol>
<li id="fn1"><p>https://www.rstudio.com/wp-content/uploads/2016/09/RegExCheatsheet.pdf<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./12-dataviz-principles.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Data visualization principles</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./14-web-scraping.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Web scraping</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>